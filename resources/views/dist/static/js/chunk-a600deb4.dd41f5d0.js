(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a600deb4"],{"328e":function(t,e,n){},6183:function(t,e,n){"use strict";n("328e")},b40a:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return o}));var a=n("b775"),i="/api/es_doc/";function s(t){return Object(a["a"])({url:i+"DeleteRowByIDAction",method:"post",data:t})}function r(t){return Object(a["a"])({url:i+"UpdateByIDAction",method:"post",data:t})}function o(t){return Object(a["a"])({url:i+"InsertAction",method:"post",data:t})}},f46e:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"app-container",staticStyle:{background:"white",height:"95%"}},[""!=t.indexName?[n("div",{staticClass:"filter-container"},[n("el-tabs",{model:{value:t.crudTab,callback:function(e){t.crudTab=e},expression:"crudTab"}},[n("el-tab-pane",{attrs:{label:t.$t("筛选"),name:"filter"}},[n("filter-where",{attrs:{"table-typ":"2","data-type-map":t.attrMap,options:t.eventAttrOptions},model:{value:t.whereFilter,callback:function(e){t.whereFilter=e},expression:"whereFilter"}})],1),t._v(" "),n("el-tab-pane",{attrs:{label:t.$t("排序"),name:"sort"}},[n("div",{staticClass:"filter-container"},[n("div",{staticClass:"relation-row"},t._l(t.sortList,(function(e,a){return n("div",{key:a,staticClass:"action-row row___xwl"},[n("div",{staticClass:"action-left"},[n("el-select",{staticClass:"filter-item",staticStyle:{width:"300px","margin-left":"30px"},attrs:{filterable:"",size:"mini",placeholder:t.$t("请选择")},model:{value:t.sortList[a].col,callback:function(e){t.$set(t.sortList[a],"col",e)},expression:"sortList[index].col"}},t._l(t.eventAttrOptionsProp,(function(e){return n("el-option-group",{key:e.label,attrs:{label:e.label}},t._l(e.options,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}},[n("span",{staticStyle:{float:"left"}},[t._v(t._s(e.label))]),t._v(" "),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.value))])])})),1)})),1),t._v(" "),n("el-select",{staticClass:"filter-item",staticStyle:{width:"100px","margin-left":"30px"},attrs:{size:"mini",placeholder:t.$t("请选择排序规则"),filterable:""},model:{value:t.sortList[a].sortRule,callback:function(e){t.$set(t.sortList[a],"sortRule",e)},expression:"sortList[index].sortRule"}},[n("el-option",{attrs:{label:t.$t("正序排"),value:"asc"}}),t._v(" "),n("el-option",{attrs:{label:t.$t("倒序排"),value:"desc"}})],1),t._v(" "),n("a-button",{staticClass:"actions_xwl_btn",staticStyle:{"margin-left":"30px"},attrs:{type:"link",icon:"close-circle"},on:{click:function(e){return t.deleteSort(a)}}})],1)])})),0)]),t._v(" "),n("div",{staticStyle:{padding:"0 12px"}},[n("span",{staticClass:"footadd___2D4YB",staticStyle:{color:"#3d90ff"},on:{click:t.pushSort}},[n("a-icon",{attrs:{type:"filter"}}),t._v("\n                 "+t._s(t.$t("增加排序"))+"\n               ")],1)])])],1)],1),t._v(" "),n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"filter-container"},[n("el-button",{staticClass:"filter-item",attrs:{size:"mini",icon:"el-icon-view",type:"warning"},on:{click:function(e){return t.getdsl(1)}}},[t._v("查看查询语句\n           ")]),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{size:"mini",icon:"el-icon-search",type:"success"},on:{click:function(e){return t.search(1)}}},[t._v("查询\n           ")]),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{disabled:t.downloadLoading,loading:t.downloadLoading,size:"mini",icon:"el-icon-download",type:"primary"},on:{click:function(e){return t.download()}}},[t._v("下载\n           ")])],1),t._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{height:"400",data:t.tableData,"use-virtual":"","row-height":30}},[n("el-table-column",{attrs:{label:"ID",align:"center",fixed:"","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[[t._v("\n                 "+t._s(e.row["_id"])+"\n               ")]]}}],null,!1,1126760641)}),t._v(" "),t._l(t.tableHeader,(function(e,a){return"xwl_index"!=e&&"_id"!=e?n("el-table-column",{key:a,attrs:{prop:e,sortable:!0,align:"center",label:e},scopedSlots:t._u([{key:"default",fn:function(a){return[void 0!=a.row[e]?n("el-popover",{attrs:{placement:"top-start",trigger:"hover"}},[n("div",[t._v(t._s(a.row[e].toString()))]),t._v(" "),a.row[e].toString().length>=20?n("span",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(a.row[e].toString().substr(0,20)+"...")+"\n                 ")]):n("span",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(a.row[e].toString())+"\n                 ")])]):t._e()]}}],null,!0)}):t._e()})),t._v(" "),n("el-table-column",{attrs:{align:"center",label:t.$t("操作"),fixed:"right",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button-group",[n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(n){return t.look(e.$index)}}},[t._v("\n                   编辑\n                 ")]),t._v(" "),n("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(n){return t.deleteByID(e.row,e.$index)}}},[t._v(t._s(t.$t("删除"))+"\n                 ")])],1)]}}],null,!1,3000946180)})],2),t._v(" "),n("el-pagination",{attrs:{"current-page":t.input.page,"page-sizes":[10,20,30,50,100,150,200],"page-size":t.input.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.count},on:{"size-change":t.handleSizeChange,"current-change":t.search}})],1),t._v(" "),n("el-drawer",{ref:"drawer",attrs:{title:"详细数据","before-close":t.drawerHandleClose,visible:t.drawerShow,direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"50%"},on:{"update:visible":function(e){t.drawerShow=e}}},[n("el-tag",{staticClass:"filter-item"},[t._v("操作")]),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{type:"primary",size:"mini"},on:{click:t.updateByID}},[t._v("修改\n         ")]),t._v(" "),n("json-editor",{staticClass:"res-body",attrs:{height:"900",styles:"width: 100%",title:"详细数据"},on:{getValue:t.getEditDoc},model:{value:JSON.stringify(t.jsonData,null,"\t"),callback:function(e){t.$set(JSON,"stringify(jsonData,null, '\t')",e)},expression:"JSON.stringify(jsonData,null, '\\t')"}})],1),t._v(" "),n("el-drawer",{ref:"drawer",attrs:{title:"查询DSL","before-close":t.drawerHandleClose,visible:t.queryDslShow,direction:"rtl","close-on-press-escape":"","destroy-on-close":"",size:"50%"},on:{"update:visible":function(e){t.queryDslShow=e}}},[n("json-editor",{staticClass:"res-body",attrs:{height:"900",styles:"width: 100%",title:"DSL",read:!0},model:{value:JSON.stringify(t.queryDsl,null,"\t"),callback:function(e){t.$set(JSON,"stringify(queryDsl,null, '\t')",e)},expression:"JSON.stringify(queryDsl,null, '\\t')"}})],1)]:n("div",{staticStyle:{background:"white !important",padding:"40px",width:"300px",height:"800px","text-align":"center",margin:"0px auto",position:"relative",top:"30%"}},[n("a-empty",[n("span",{attrs:{slot:"description"},slot:"description"},[t._v(t._s(t.$t("请先点击左侧索引名称")))])])],1)],2)])},i=[],s=(n("1bc7"),n("32ea"),n("182c")),r=(n("e186"),n("c3ae")),o=(n("d91d"),n("b775")),c="/api/es_crud/";function l(t){return Object(o["a"])({url:c+"GetList",method:"post",transformResponse:[function(t){return jsonlint.parse(t)}],data:t})}function u(t){return Object(o["a"])({url:c+"GetDSL",method:"post",data:t})}function p(t){return Object(o["a"])({responseType:"arraybuffer",url:c+"Download",method:"post",data:t})}var d=n("c236"),h=n("b40a"),f=n("ed08"),m={name:"Crud",components:{JsonEditor:function(){return Promise.all([n.e("chunk-31af6a17"),n.e("chunk-03b113fc"),n.e("chunk-36ba3740")]).then(n.bind(null,"fa7e"))},FilterWhere:function(){return n.e("chunk-a323b60e").then(n.bind(null,"0c2e"))}},props:{indexName:{type:String,default:""},attrMapProp:{type:Array,default:[]},eventAttrOptionsProp:{type:Array,default:[]}},data:function(){return{properties:{},openAddDialog:!1,tableLoading:!1,tableHeader:[],tableData:[],crudTab:"filter",eventAttrOptions:this.eventAttrOptionsProp,attrMap:this.attrMapProp,whereFilter:{filterType:"COMPOUND",filts:[],relation:"且"},sortList:[],input:{page:1,limit:20},count:0,typName:"",newDoc:{},jsonData:{},tableDataClone:[],drawerShow:!1,queryDslShow:!1,queryDsl:{},downloadLoading:!1}},mounted:function(){""!=this.indexName&&this.search(1)},methods:{download:function(){var t=this,e={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:this.$store.state.baseData.EsConnectID},n=document.createElement("a");this.downloadLoading=!0,p(e).then((function(e){if(e){var a=new Blob([e],{type:"application/vnd.ms-excel"}),i=URL.createObjectURL(a);n.href=i,n.download=t.indexName+".csv",n.click(),URL.revokeObjectURL(i)}t.downloadLoading=!1})).catch((function(e){t.downloadLoading=!1,console.error(e)}))},drawerShowFn:function(){var t=this;this.drawerShow=!1,this.$nextTick((function(){t.drawerShow=!0}))},look:function(t){this.index=t,console.log("this.tableDataClone",this.tableDataClone),this.jsonData=this.tableDataClone[t],this.drawerShowFn()},updateByID:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,n,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("this.jsonData",this.jsonData),e=this.jsonData,n=e["_source"],a={},a["es_connect"]=this.$store.state.baseData.EsConnectID,a["index"]=e["_index"],a["type_name"]=e["_type"],a["id"]=e["_id"],a["json"]=n,t.next=11,Object(h["c"])(a);case 11:i=t.sent,0==i.code?(this.search(1),this.$message({type:"success",message:i.msg})):this.$message({type:"error",message:i.msg});case 13:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getEditDoc:function(t){try{var e=JSON.parse(t);this.jsonData=e}catch(n){}},getNewDoc:function(t){try{this.newDoc=JSON.parse(t)}catch(e){}},add:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.newDoc,n={},n["es_connect"]=this.$store.state.baseData.EsConnectID,n["index"]=this.indexName,n["type_name"]=this.typName,n["json"]=e,t.next=8,Object(h["b"])(n);case 8:a=t.sent,0==a.code?this.$message({type:"success",message:a.msg+"(_id为:"+a.data._id+")",duration:2e4}):this.$message({type:"error",message:a.msg});case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),drawerHandleClose:function(t){t()},deleteByID:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,n){var a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.$confirm("确定删除ID为【"+e["_id"]+"】的这条文档吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function t(){var n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={},n["es_connect"]=a.$store.state.baseData.EsConnectID,n["index_name"]=a.indexName,n["type"]=a.typName,n["id"]=e["_id"],t.next=7,Object(h["a"])(n);case 7:i=t.sent,0==i.code?setTimeout(Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a.search(1);case 2:a.$message({type:"success",message:i.msg});case 3:case"end":return t.stop()}}),t)}))),1e3):a.$message({type:"error",message:i.msg});case 9:case"end":return t.stop()}}),t)})))).catch((function(t){console.error(t)}));case 1:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}(),initTableData:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var n,a,i,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.hasOwnProperty("hits")&&e["hits"]["hits"].length>0){for(a in this.typName=e["hits"]["hits"][0]["_type"],n=[],this.tableDataClone=Object(f["b"])(e["hits"]["hits"]),e["hits"]["hits"])i=e["hits"]["hits"][a]["_source"],i["_id"]=e["hits"]["hits"][a]["_id"],i["_score"]=e["hits"]["hits"][a]["_score"],i["xwl_index"]=a,n.push(i);for(r in this.tableData=n,this.tableData)for(o in this.tableData[r])"object"!==Object(s["a"])(this.tableData[r][o])&&"array"!==typeof this.tableData[r][o]||(this.tableData[r][o]=JSON.stringify(this.tableData[r][o]))}case 1:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getMapping:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,n,a,i,s,r,o,c,l,u,p,h,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={},e["es_connect"]=this.$store.state.baseData.EsConnectID,e["index_name"]=this.indexName,t.next=5,Object(d["a"])(e);case 5:if(n=t.sent,a=n.data,i=n.code,s=n.msg,0!=i){t.next=32;break}if(6!=a.ver){t.next=29;break}r=Object.keys(a.list[e["index_name"]].mappings),t.t0=regeneratorRuntime.keys(r);case 13:if((t.t1=t.t0()).done){t.next=20;break}if(o=t.t1.value,"_default_"!=r[o]){t.next=18;break}return r.splice(o,1),t.abrupt("break",20);case 18:t.next=13;break;case 20:for(u in console.log("mappings",r),c=Object.keys(a.list[e["index_name"]].mappings[r[0]].properties),this.properties=a.list[e["index_name"]].mappings[r[0]].properties,l=[],l.push("_id"),c)"_id"!=c[u]&&l.push(c[u]);this.tableHeader=l,t.next=30;break;case 29:if(7==a.ver||8==a.ver){for(f in p=Object.keys(a.list[e["index_name"]].mappings.properties),this.properties=a.list[e["index_name"]].mappings.properties,console.log("properties",a.list[e["index_name"]]),h=[],h.push("_id"),p)"_id"!=p[f]&&h.push(p[f]);this.tableHeader=h}case 30:t.next=33;break;case 32:this.$message({type:"error",message:s});case 33:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),pushSort:function(){this.sortList.push({col:"",sortRule:"desc"})},deleteSort:function(t){this.sortList.splice(t,1)},handleSizeChange:function(t){this.input.limit=t,this.search(1)},getdsl:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:this.$store.state.baseData.EsConnectID,page:this.input.page,limit:this.input.limit},t.next=3,u(e);case 3:if(n=t.sent,0==n.code){t.next=7;break}return this.$message({type:"error",message:n.msg}),t.abrupt("return");case 7:this.queryDsl=n.data.list,this.queryDslShow=!0;case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),search:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.tableLoading=!0,this.input.page=e||1,n={index_name:this.indexName,relation:this.whereFilter,sort_list:this.sortList,es_connect:this.$store.state.baseData.EsConnectID,page:this.input.page,limit:this.input.limit},t.next=5,l(n);case 5:if(a=t.sent,0==a.code){t.next=11;break}return this.$message({type:"error",message:a.msg}),this.tableData=[],this.tableLoading=!1,t.abrupt("return");case 11:return this.count=a.data.count,t.next=14,this.getMapping();case 14:if(!(this.count>0)){t.next=19;break}return t.next=17,this.initTableData(a.data.list);case 17:t.next=20;break;case 19:this.tableData=[];case 20:this.tableLoading=!1;case 21:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}},b=m,g=(n("6183"),n("cba8")),v=Object(g["a"])(b,a,i,!1,null,"cf47215c",null);e["default"]=v.exports}}]);