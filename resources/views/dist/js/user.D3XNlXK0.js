import{aT as e,aK as l,aU as a,bY as t,cr as s,a_ as o,cy as i,b8 as r,cz as d,cA as n,cB as p,cC as u,cD as c,at as m,e as g,h,C as f,F as w,l as _,w as b,i as y,p as C,S as k,V,f as $,a7 as U,a3 as v,j,E as x,a5 as P,a6 as D,bi as L}from"./index.CLV6ek40.js";import{E}from"./el-loading.BUdDMhkI.js";import{E as F}from"./el-pagination.D7JQcvSn.js";/* empty css               */import{E as S,a as z}from"./el-select.Cgog8UO3.js";import"./el-scrollbar.JSBZHDlB.js";import"./el-popper.DN1O68l_.js";import{E as M}from"./el-card.BDOdcgEj.js";import{E as T,a as R}from"./el-table-column.BPgiV38a.js";import"./el-checkbox.CjSQ3F-Y.js";import{a as B,b as A,E as I}from"./el-dropdown-item.BLS-zIe0.js";import{E as O}from"./el-popover.BmKUyV2Z.js";import{a as q,E as K}from"./el-form.D6tidVci.js";import{E as G}from"./el-switch.CHxKNw8v.js";import"./el-form-item.l0sNRNKZ.js";import{d as H}from"./index.B6fdKp2E.js";import{_ as J}from"./oauth.vue_vue_type_script_setup_true_lang.BUJVYFBr.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as Q}from"./index.DHrNonpr.js";import"./use-dialog.B7hCziNn.js";import"./isUndefined.DgmxjSXK.js";import"./strings.CS2wJJ2k.js";import"./index.DXxCJmyx.js";import"./_Uint8Array.DIi5Oa4y.js";import"./dropdown.OSpZgcEC.js";import"./refs.QvgRPoko.js";import"./el-tab-pane.Bx882FCs.js";const Y={id:"",password:"",realname:"",email:"",work_wechat_uid:"",role_ids:[],username:"",role_name:""},W={class:"app-container"},X={class:"role-tags"},Z={class:"popover-tags"},ee={class:"pagination-container"},le={style:{"text-align":"right"}};const ae=N({setup(){const a=e(),{device:t}=l(a);return{device:t}},data:()=>({allRoleConfig:[],input:{page:1,limit:10,user_name:"",real_name:"",is_ban:!1,role_ids:[]},count:0,updatePwdForm:{password:"",confirmPassword:"",id:0},pwdDialogVisible:!1,role:Object.assign({},Y),routes:[],loading:!1,rolesList:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},chanCfgList:[],chanCfgMap:[],isCollapsed:!0}),computed:{isMobile(){return this.device===a.MOBILE}},async created(){await this.getRoleOpt(),this.getUserList(1)},components:{Oauth:J},methods:{async getRoleOpt(){const e=await t();for(var l of e.data)this.chanCfgList.push(l),this.chanCfgMap[l.id]=l.name;this.allRoleConfig=[];for(let a of e.data){const e={label:a.name,key:a.id.toString(),disabled:!1};this.allRoleConfig.push(e)}},handleSizeChange(e){this.input.limit=e,this.getUserList(1)},async getUserList(e){this.input.page=e||1,this.loading=!0;let l=[];for(let t of this.input.role_ids)l.push(Number(t));const a=await s({page:e,page_size:this.input.limit,user_name:this.input.user_name,real_name:this.input.real_name,is_ban:this.input.is_ban,role_ids:l});this.loading=!1,this.count=a.data.count,this.rolesList=a.data.list},async submitPwdForm(){if(""==this.updatePwdForm.password)return void o.error({message:"密码不能为空",type:"error"});if(this.updatePwdForm.confirmPassword!=this.updatePwdForm.password)return void o.error({message:"两次密码输入不一致",type:"error"});const e=await i(this.updatePwdForm);0==e.code?(o.success({message:e.msg,type:"success"}),this.updatePwdForm.password="",this.updatePwdForm.confirmPassword="",this.pwdDialogVisible=!1):o.error({message:e.msg,type:"error"})},openPwdDialog(e){this.updatePwdForm.id=e.id,this.pwdDialogVisible=!0},handleAddRole(){this.role=Object.assign({},Y),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.role=H(e.row),this.role.password=""},handleDelete({$index:e,row:l}){r.confirm("确认删除该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await d({id:l.id});0==e.code?(this.getUserList(1),o.success({type:"success",offset:60,message:e.msg})):o({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},SealUser({$index:e,row:l}){r.confirm("确认封禁该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await n({id:l.id});0==e.code?(this.getUserList(1),o.success({type:"success",offset:60,message:e.msg})):o({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},UnSealUser({$index:e,row:l}){r.confirm("确认解封该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await p({id:l.id});0==e.code?(this.getUserList(1),o.success({type:"success",offset:60,message:e.msg})):o({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},async confirmRole(){const e="edit"===this.dialogType;if(0==this.role.role_ids.length)return o.error({message:"权限组不能为空",type:"error"}),!1;if(e){const e=await u(this.role);if(0!=e.code)return void o.error({message:e.msg,type:"error"});o.success({message:e.msg,type:"success"}),this.getUserList(1)}else{if(this.role.password.length<5&&""!=this.role.password.trim())return o.error({message:"密码长度必须大于5",type:"error"}),!1;const e=await c(this.role);if(0!=e.code)return void o.error({message:e.msg,type:"error"});o.success({message:e.msg,type:"success"}),this.getUserList(1)}this.dialogVisible=!1},toggleCollapse(){this.isCollapsed=!this.isCollapsed}}},[["render",function(e,l,a,t,s,o){const i=m("ArrowDown"),r=x,d=S,n=z,p=q,u=P,c=G,H=D,J=K,N=T,Y=Q,ae=O,te=B,se=A,oe=I,ie=R,re=M,de=F,ne=E,pe=L;return g(),h("div",W,[f("div",{class:y(["search-container",{"is-collapsed":s.isCollapsed&&o.isMobile}])},[o.isMobile?(g(),h("div",{key:0,class:"search-header",onClick:l[0]||(l[0]=(...e)=>o.toggleCollapse&&o.toggleCollapse(...e))},[f("span",null,w(e.$t("搜索条件")),1),_(r,{class:y({"is-collapsed":s.isCollapsed})},{default:b((()=>[_(i)])),_:1},8,["class"])])):C("",!0),_(J,{inline:!0},{default:b((()=>[_(p,{label:"权限组:"},{default:b((()=>[_(n,{style:{width:"180px"},multiple:"",modelValue:s.input.role_ids,"onUpdate:modelValue":l[1]||(l[1]=e=>s.input.role_ids=e),"reserve-keyword":"","collapse-tags":"",placeholder:e.$t("权限组"),class:"filter-item",filterable:""},{default:b((()=>[(g(!0),h(k,null,V(s.allRoleConfig,(e=>(g(),$(d,{key:e.key,label:e.label,value:e.key},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1}),_(p,{label:"用户名:"},{default:b((()=>[_(u,{clearable:"",modelValue:s.input.user_name,"onUpdate:modelValue":l[2]||(l[2]=e=>s.input.user_name=e),style:{width:"200px"}},null,8,["modelValue"])])),_:1}),_(p,{label:"真实姓名:"},{default:b((()=>[_(u,{clearable:"",modelValue:s.input.real_name,"onUpdate:modelValue":l[3]||(l[3]=e=>s.input.real_name=e),style:{width:"200px"}},null,8,["modelValue"])])),_:1}),_(p,{label:"是否封禁:"},{default:b((()=>[_(c,{onChange:l[4]||(l[4]=e=>o.getUserList(1)),modelValue:s.input.is_ban,"onUpdate:modelValue":l[5]||(l[5]=e=>s.input.is_ban=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1}),_(p,{label:""},{default:b((()=>[_(H,{type:"success",class:"filter-item",onClick:l[6]||(l[6]=e=>o.getUserList(1))},{default:b((()=>[U(w(e.$t("查询")),1)])),_:1}),_(H,{type:"warning",class:"filter-item",onClick:o.handleAddRole},{default:b((()=>[U(w(e.$t("新增")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})],2),_(re,{shadow:"never",class:"table-container"},{default:b((()=>[v((g(),$(ie,{data:s.rolesList},{default:b((()=>[_(N,{align:"center",sortable:"",label:"id",width:"50"},{default:b((e=>[U(w(e.row.id),1)])),_:1}),_(N,{align:"center",label:e.$t("用户名"),width:"100"},{default:b((e=>[U(w(e.row.username),1)])),_:1},8,["label"]),_(N,{align:"center",width:"160",label:e.$t("权限组")},{default:b((e=>[f("div",X,[e.row.role_ids.length<=2?(g(!0),h(k,{key:0},V(e.row.role_ids,(e=>(g(),$(Y,{key:e},{default:b((()=>[U(w(s.chanCfgMap[e]),1)])),_:2},1024)))),128)):(g(),h(k,{key:1},[(g(!0),h(k,null,V(e.row.role_ids.slice(0,1),(e=>(g(),$(Y,{key:e},{default:b((()=>[U(w(s.chanCfgMap[e]),1)])),_:2},1024)))),128)),_(ae,{placement:"bottom",trigger:"hover",width:200,"popper-class":"role-popover"},{reference:b((()=>[_(Y,{class:"more-tag"},{default:b((()=>[U(" +"+w(e.row.role_ids.length-1),1)])),_:2},1024)])),default:b((()=>[f("div",Z,[(g(!0),h(k,null,V(e.row.role_ids.slice(1),(e=>(g(),$(Y,{key:e,style:{"margin-left":"1rem"}},{default:b((()=>[U(w(s.chanCfgMap[e]),1)])),_:2},1024)))),128))])])),_:2},1024)],64))])])),_:1},8,["label"]),_(N,{align:"center",width:"100",label:e.$t("真实姓名")},{default:b((e=>[U(w(e.row.realname),1)])),_:1},8,["label"]),_(N,{align:"center",width:"200",label:e.$t("电子邮箱")},{default:b((e=>[U(w(e.row.email),1)])),_:1},8,["label"]),_(N,{align:"center",width:"100",label:e.$t("企微成员UserID")},{default:b((e=>[U(w(e.row.work_wechat_uid),1)])),_:1},8,["label"]),_(N,{align:"center",sortable:"",width:"180",label:e.$t("创建时间")},{default:b((e=>[U(w(e.row.create_time),1)])),_:1},8,["label"]),_(N,{align:"center",sortable:"",width:"180",label:e.$t("修改时间")},{default:b((e=>[U(w(e.row.update_time),1)])),_:1},8,["label"]),_(N,{align:"center",sortable:"",width:"180",label:e.$t("最后登录时间")},{default:b((e=>[U(w(e.row.last_login_time),1)])),_:1},8,["label"]),_(N,{align:"center",label:e.$t("操作"),fixed:"right",width:o.isMobile?80:400},{default:b((l=>[o.isMobile?(g(),$(oe,{key:1,trigger:"click"},{dropdown:b((()=>[_(se,null,{default:b((()=>[_(te,{command:"1"},{default:b((()=>[_(H,{type:"primary",onClick:j((e=>o.handleEdit(l)),["stop"])},{default:b((()=>[U(w(e.$t("编辑")),1)])),_:2},1032,["onClick"])])),_:2},1024),_(te,null,{default:b((()=>[_(H,{type:"info",onClick:e=>o.openPwdDialog(l.row)},{default:b((()=>[U(w(e.$t("重置密码")),1)])),_:2},1032,["onClick"])])),_:2},1024),_(te,null,{default:b((()=>[1==l.row.is_ban?(g(),$(H,{key:0,type:"primary",onClick:e=>o.UnSealUser(l)},{default:b((()=>[U(w(e.$t("解封")),1)])),_:2},1032,["onClick"])):C("",!0),0==l.row.is_ban?(g(),$(H,{key:1,type:"danger",onClick:e=>o.SealUser(l)},{default:b((()=>[U(w(e.$t("封禁")),1)])),_:2},1032,["onClick"])):C("",!0)])),_:2},1024),_(te,null,{default:b((()=>[_(H,{type:"danger",onClick:e=>o.handleDelete(l)},{default:b((()=>[U(w(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:b((()=>[_(H,null,{default:b((()=>[U("管理")])),_:1})])),_:2},1024)):(g(),h(k,{key:0},[_(H,{type:"primary",onClick:e=>o.handleEdit(l)},{default:b((()=>[U(w(e.$t("编辑")),1)])),_:2},1032,["onClick"]),_(H,{type:"info",onClick:e=>o.openPwdDialog(l.row)},{default:b((()=>[U(w(e.$t("重置密码")),1)])),_:2},1032,["onClick"]),1==l.row.is_ban?(g(),$(H,{key:0,type:"primary",onClick:e=>o.UnSealUser(l)},{default:b((()=>[U(w(e.$t("解封")),1)])),_:2},1032,["onClick"])):C("",!0),0==l.row.is_ban?(g(),$(H,{key:1,type:"danger",onClick:e=>o.SealUser(l)},{default:b((()=>[U(w(e.$t("封禁")),1)])),_:2},1032,["onClick"])):C("",!0),_(H,{type:"danger",onClick:e=>o.handleDelete(l)},{default:b((()=>[U(w(e.$t("删除")),1)])),_:2},1032,["onClick"])],64))])),_:1},8,["label","width"])])),_:1},8,["data"])),[[pe,s.loading]])])),_:1}),f("div",ee,[_(de,{background:"","current-page":s.input.page,"page-size":s.input.limit,total:s.count,layout:o.isMobile?"pager":"total, sizes, prev, pager, next, jumper",onCurrentChange:o.getUserList,onSizeChange:o.handleSizeChange},null,8,["current-page","page-size","total","layout","onCurrentChange","onSizeChange"])]),_(ne,{title:"修改密码",modelValue:s.pwdDialogVisible,"onUpdate:modelValue":l[10]||(l[10]=e=>s.pwdDialogVisible=e),size:o.isMobile?"100%":"50%"},{footer:b((()=>[_(H,{onClick:l[9]||(l[9]=e=>s.pwdDialogVisible=!1)},{default:b((()=>[U("取消")])),_:1}),_(H,{type:"primary",onClick:o.submitPwdForm},{default:b((()=>[U("修改")])),_:1},8,["onClick"])])),default:b((()=>[_(J,{"label-width":"100px"},{default:b((()=>[_(p,{label:"新密码",required:""},{default:b((()=>[_(u,{modelValue:s.updatePwdForm.password,"onUpdate:modelValue":l[7]||(l[7]=e=>s.updatePwdForm.password=e),"show-password":"",type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])])),_:1}),_(p,{label:"确认密码",required:""},{default:b((()=>[_(u,{modelValue:s.updatePwdForm.confirmPassword,"onUpdate:modelValue":l[8]||(l[8]=e=>s.updatePwdForm.confirmPassword=e),"show-password":"",type:"password",placeholder:"请再次输入新密码"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","size"]),_(ne,{modelValue:s.dialogVisible,"onUpdate:modelValue":l[18]||(l[18]=e=>s.dialogVisible=e),size:o.isMobile?"100%":"50%",title:"edit"===s.dialogType?e.$t("编辑用户信息"):e.$t("新建用户信息")},{default:b((()=>[_(J,{model:s.role,"label-width":"100px","label-position":"left"},{default:b((()=>[_(p,{label:e.$t("用户名")},{default:b((()=>[_(u,{modelValue:s.role.username,"onUpdate:modelValue":l[11]||(l[11]=e=>s.role.username=e),placeholder:e.$t("用户名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),"edit"!==s.dialogType?(g(),$(p,{key:0,label:e.$t("密码")},{default:b((()=>[_(u,{"show-password":"",type:"password",modelValue:s.role.password,"onUpdate:modelValue":l[12]||(l[12]=e=>s.role.password=e),placeholder:e.$t("不填则为系统自动生成")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):C("",!0),_(p,{label:e.$t("真实姓名")},{default:b((()=>[_(u,{modelValue:s.role.realname,"onUpdate:modelValue":l[13]||(l[13]=e=>s.role.realname=e),placeholder:e.$t("真实姓名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),_(p,{label:e.$t("电子邮箱")},{default:b((()=>[_(u,{modelValue:s.role.email,"onUpdate:modelValue":l[14]||(l[14]=e=>s.role.email=e),placeholder:e.$t("电子邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),_(p,{label:e.$t("企微UserID")},{default:b((()=>[_(u,{modelValue:s.role.work_wechat_uid,"onUpdate:modelValue":l[15]||(l[15]=e=>s.role.work_wechat_uid=e),placeholder:e.$t("企业微信成员UserID。对应管理端的账号，企业内必须唯一")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),_(p,{label:e.$t("请选择权限组")},{default:b((()=>[_(n,{modelValue:s.role.role_ids,"onUpdate:modelValue":l[16]||(l[16]=e=>s.role.role_ids=e),multiple:"",placeholder:e.$t("请选择权限组"),clearable:"",filterable:""},{default:b((()=>[(g(!0),h(k,null,V(s.chanCfgList,(e=>(g(),$(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model"]),f("div",le,[_(H,{type:"danger",onClick:l[17]||(l[17]=e=>s.dialogVisible=!1)},{default:b((()=>[U(w(e.$t("取消")),1)])),_:1}),_(H,{type:"primary",onClick:o.confirmRole},{default:b((()=>[U(w(e.$t("确认")),1)])),_:1},8,["onClick"])])])),_:1},8,["modelValue","size","title"])])}],["__scopeId","data-v-3e7a0540"]]);export{ae as default};
//# sourceMappingURL=user.D3XNlXK0.js.map
