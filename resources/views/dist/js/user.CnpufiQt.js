import{aQ as e,aH as l,aV as a,bL as t,ca as s,b5 as i,ci as o,aY as r,cj as d,ck as n,cl as c,cm as u,cn as p,at as m,e as g,h,C as f,l as w,w as _,a7 as b,F as y,a3 as V,f as k,S as C,V as $,p as U,j,a6 as P,a5 as D,ba as x}from"./index.DXEnBsU-.js";/* empty css                   *//* empty css               */import{a as v,E as L}from"./el-select.D_RdXRk0.js";import"./el-scrollbar.v1J_9dPK.js";import"./el-tooltip.BJE2ZRH-.js";import{E as F}from"./el-drawer.BCyMtrUV.js";import{E as z}from"./el-pagination.D6TNZcC6.js";import{E}from"./el-card.BtZDn0uG.js";import{E as S,a as T}from"./el-table-column.C-GnYxI4.js";import"./el-checkbox.BSVWGSnx.js";import{E as M,a as B,b as O}from"./el-dropdown-item.6k2t50TU.js";import{a as A,E as R}from"./el-form.DzZwTs12.js";import"./el-form-item.l0sNRNKZ.js";import{d as I}from"./index.B6fdKp2E.js";import{_ as q}from"./oauth.vue_vue_type_script_setup_true_lang.uRuzsDrN.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as Q}from"./index.6-cmkaky.js";import"./strings.BZrAlt1C.js";import"./index.Duti2LV-.js";import"./_Uint8Array.1eytTgEC.js";import"./isUndefined.DgmxjSXK.js";import"./use-dialog.C23R4RJY.js";import"./refs.0xaTRm6R.js";import"./el-tab-pane.euoSHJmh.js";import"./el-switch.DKR-h8k2.js";const G={id:"",password:"",realname:"",email:"",work_wechat_uid:"",role_ids:[],username:"",role_name:""},N={class:"app-container"},Y={class:"search-container"},J={class:"pagination-container"},K={style:{"text-align":"right"}};const W=H({setup(){const a=e(),{device:t}=l(a);return{device:t}},data:()=>({input:{page:1,limit:10},count:0,updatePwdForm:{password:"",confirmPassword:"",id:0},authDialogVisible:!1,pwdDialogVisible:!1,role:Object.assign({},G),routes:[],loading:!1,rolesList:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},chanCfgList:[],chanCfgMap:[]}),computed:{isMobile(){return this.device===a.MOBILE}},async created(){await this.getRoleOpt(),this.getUserList(1)},components:{Oauth:q},methods:{async getRoleOpt(){const e=await t();for(var l of e.data)this.chanCfgList.push(l),this.chanCfgMap[l.id]=l.name},handleSizeChange(e){this.input.limit=e,this.getUserList(1)},async getUserList(e){this.input.page=e||1,this.loading=!0;const l=await s({page:e,page_size:this.input.limit});this.loading=!1,this.count=l.data.count,this.rolesList=l.data.list},async submitPwdForm(){if(""==this.updatePwdForm.password)return void i.error({message:"密码不能为空",type:"error"});if(this.updatePwdForm.confirmPassword!=this.updatePwdForm.password)return void i.error({message:"两次密码输入不一致",type:"error"});const e=await o(this.updatePwdForm);0==e.code?(i.success({message:e.msg,type:"success"}),this.updatePwdForm.password="",this.updatePwdForm.confirmPassword="",this.pwdDialogVisible=!1):i.error({message:e.msg,type:"error"})},openAuthCfgDialog(){this.authDialogVisible=!0},openPwdDialog(e){this.updatePwdForm.id=e.id,this.pwdDialogVisible=!0},handleAddRole(){this.role=Object.assign({},G),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.role=I(e.row),this.role.password=""},handleDelete({$index:e,row:l}){r.confirm("确认删除该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await d({id:l.id});0==e.code?(this.getUserList(1),i.success({type:"success",message:e.msg})):i({type:"error",message:e.msg})})).catch((e=>{console.error(e)}))},SealUser({$index:e,row:l}){r.confirm("确认封禁该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await n({id:l.id});0==e.code?(this.getUserList(1),i.success({type:"success",message:e.msg})):i({type:"error",message:e.msg})})).catch((e=>{console.error(e)}))},UnSealUser({$index:e,row:l}){r.confirm("确认解封该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await c({id:l.id});0==e.code?(this.getUserList(1),i.success({type:"success",message:e.msg})):i({type:"error",message:e.msg})})).catch((e=>{console.error(e)}))},async confirmRole(){const e="edit"===this.dialogType;if(0==this.role.role_ids.length)return i.error({message:"角色不能为空",type:"error"}),!1;if(e){const e=await u(this.role);if(0!=e.code)return void i.error({message:e.msg,type:"error"});i.success({message:e.msg,type:"success"}),this.getUserList(1)}else{if(this.role.password.length<5&&""!=this.role.password.trim())return i.error({message:"密码长度必须大于5",type:"error"}),!1;const e=await p(this.role);if(0!=e.code)return void i.error({message:e.msg,type:"error"});i.success({message:e.msg,type:"success"}),this.getUserList(1)}this.dialogVisible=!1}}},[["render",function(e,l,a,t,s,i){const o=P,r=A,d=R,n=S,c=Q,u=M,p=B,I=O,q=T,H=E,G=z,W=m("oauth"),X=F,Z=D,ee=v,le=L,ae=x;return g(),h("div",N,[f("div",Y,[w(d,{inline:!0},{default:_((()=>[w(r,{label:""},{default:_((()=>[w(o,{type:"info",class:"filter-item",onClick:i.openAuthCfgDialog},{default:_((()=>[b(y(e.$t("第三方认证")),1)])),_:1},8,["onClick"]),w(o,{type:"warning",class:"filter-item",onClick:i.handleAddRole},{default:_((()=>[b(y(e.$t("新增")),1)])),_:1},8,["onClick"]),w(o,{type:"success",class:"filter-item",onClick:l[0]||(l[0]=e=>i.getUserList(1))},{default:_((()=>[b(y(e.$t("查询")),1)])),_:1})])),_:1})])),_:1})]),w(H,{shadow:"never",class:"table-container"},{default:_((()=>[V((g(),k(q,{data:s.rolesList},{default:_((()=>[w(n,{align:"center",label:"id",width:"50"},{default:_((e=>[b(y(e.row.id),1)])),_:1}),w(n,{align:"center",label:e.$t("用户名"),width:"100"},{default:_((e=>[b(y(e.row.username),1)])),_:1},8,["label"]),w(n,{align:"center",label:e.$t("所属角色")},{default:_((e=>[(g(!0),h(C,null,$(e.row.role_ids,(e=>(g(),k(c,null,{default:_((()=>[b(y(s.chanCfgMap[e]),1)])),_:2},1024)))),256))])),_:1},8,["label"]),w(n,{align:"center",width:"100",label:e.$t("真实姓名")},{default:_((e=>[b(y(e.row.realname),1)])),_:1},8,["label"]),w(n,{align:"center",width:"200",label:e.$t("电子邮箱")},{default:_((e=>[b(y(e.row.email),1)])),_:1},8,["label"]),w(n,{align:"center",width:"100",label:e.$t("企微成员UserID")},{default:_((e=>[b(y(e.row.work_wechat_uid),1)])),_:1},8,["label"]),w(n,{align:"center",label:e.$t("操作"),fixed:"right",width:i.isMobile?80:400},{default:_((l=>[i.isMobile?(g(),k(I,{key:1,trigger:"click"},{dropdown:_((()=>[w(p,null,{default:_((()=>[w(u,{command:"1"},{default:_((()=>[w(o,{type:"primary",onClick:j((e=>i.handleEdit(l)),["stop"])},{default:_((()=>[b(y(e.$t("编辑")),1)])),_:2},1032,["onClick"])])),_:2},1024),w(u,null,{default:_((()=>[w(o,{type:"info",onClick:e=>i.openPwdDialog(l.row)},{default:_((()=>[b(y(e.$t("重置密码")),1)])),_:2},1032,["onClick"])])),_:2},1024),w(u,null,{default:_((()=>[1==l.row.is_ban?(g(),k(o,{key:0,type:"primary",onClick:e=>i.UnSealUser(l)},{default:_((()=>[b(y(e.$t("解封")),1)])),_:2},1032,["onClick"])):U("",!0),0==l.row.is_ban?(g(),k(o,{key:1,type:"danger",onClick:e=>i.SealUser(l)},{default:_((()=>[b(y(e.$t("封禁")),1)])),_:2},1032,["onClick"])):U("",!0)])),_:2},1024),w(u,null,{default:_((()=>[w(o,{type:"danger",onClick:e=>i.handleDelete(l)},{default:_((()=>[b(y(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:_((()=>[w(o,null,{default:_((()=>[b("管理")])),_:1})])),_:2},1024)):(g(),h(C,{key:0},[w(o,{type:"primary",onClick:e=>i.handleEdit(l)},{default:_((()=>[b(y(e.$t("编辑")),1)])),_:2},1032,["onClick"]),w(o,{type:"info",onClick:e=>i.openPwdDialog(l.row)},{default:_((()=>[b(y(e.$t("重置密码")),1)])),_:2},1032,["onClick"]),1==l.row.is_ban?(g(),k(o,{key:0,type:"primary",onClick:e=>i.UnSealUser(l)},{default:_((()=>[b(y(e.$t("解封")),1)])),_:2},1032,["onClick"])):U("",!0),0==l.row.is_ban?(g(),k(o,{key:1,type:"danger",onClick:e=>i.SealUser(l)},{default:_((()=>[b(y(e.$t("封禁")),1)])),_:2},1032,["onClick"])):U("",!0),w(o,{type:"danger",onClick:e=>i.handleDelete(l)},{default:_((()=>[b(y(e.$t("删除")),1)])),_:2},1032,["onClick"])],64))])),_:1},8,["label","width"])])),_:1},8,["data"])),[[ae,s.loading]])])),_:1}),f("div",J,[w(G,{background:"","current-page":s.input.page,"page-size":s.input.limit,total:s.count,onCurrentChange:i.getUserList,onSizeChange:i.handleSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])]),w(X,{title:"第三方认证设置",modelValue:s.authDialogVisible,"onUpdate:modelValue":l[1]||(l[1]=e=>s.authDialogVisible=e),size:i.isMobile?"100%":"90%"},{default:_((()=>[s.authDialogVisible?(g(),k(W,{key:0})):U("",!0)])),_:1},8,["modelValue","size"]),w(X,{title:"修改密码",modelValue:s.pwdDialogVisible,"onUpdate:modelValue":l[5]||(l[5]=e=>s.pwdDialogVisible=e),size:i.isMobile?"100%":"30%"},{footer:_((()=>[w(o,{onClick:l[4]||(l[4]=e=>s.pwdDialogVisible=!1)},{default:_((()=>[b("取消")])),_:1}),w(o,{type:"primary",onClick:i.submitPwdForm},{default:_((()=>[b("修改")])),_:1},8,["onClick"])])),default:_((()=>[w(d,{"label-width":"100px"},{default:_((()=>[w(r,{label:"新密码",required:""},{default:_((()=>[w(Z,{modelValue:s.updatePwdForm.password,"onUpdate:modelValue":l[2]||(l[2]=e=>s.updatePwdForm.password=e),"show-password":"",type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])])),_:1}),w(r,{label:"确认密码",required:""},{default:_((()=>[w(Z,{modelValue:s.updatePwdForm.confirmPassword,"onUpdate:modelValue":l[3]||(l[3]=e=>s.updatePwdForm.confirmPassword=e),"show-password":"",type:"password",placeholder:"请再次输入新密码"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","size"]),w(X,{modelValue:s.dialogVisible,"onUpdate:modelValue":l[13]||(l[13]=e=>s.dialogVisible=e),size:i.isMobile?"100%":"50%",title:"edit"===s.dialogType?e.$t("编辑用户信息"):e.$t("新建用户信息")},{default:_((()=>[w(d,{model:s.role,"label-width":"100px","label-position":"left"},{default:_((()=>[w(r,{label:e.$t("用户名")},{default:_((()=>[w(Z,{modelValue:s.role.username,"onUpdate:modelValue":l[6]||(l[6]=e=>s.role.username=e),placeholder:e.$t("用户名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),"edit"!==s.dialogType?(g(),k(r,{key:0,label:e.$t("密码")},{default:_((()=>[w(Z,{"show-password":"",type:"password",modelValue:s.role.password,"onUpdate:modelValue":l[7]||(l[7]=e=>s.role.password=e),placeholder:e.$t("不填则为系统自动生成")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):U("",!0),w(r,{label:e.$t("真实姓名")},{default:_((()=>[w(Z,{modelValue:s.role.realname,"onUpdate:modelValue":l[8]||(l[8]=e=>s.role.realname=e),placeholder:e.$t("真实姓名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),w(r,{label:e.$t("电子邮箱")},{default:_((()=>[w(Z,{modelValue:s.role.email,"onUpdate:modelValue":l[9]||(l[9]=e=>s.role.email=e),placeholder:e.$t("电子邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),w(r,{label:e.$t("企微UserID")},{default:_((()=>[w(Z,{modelValue:s.role.work_wechat_uid,"onUpdate:modelValue":l[10]||(l[10]=e=>s.role.work_wechat_uid=e),placeholder:e.$t("企业微信成员UserID。对应管理端的账号，企业内必须唯一")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),w(r,{label:e.$t("请选择角色")},{default:_((()=>[w(le,{modelValue:s.role.role_ids,"onUpdate:modelValue":l[11]||(l[11]=e=>s.role.role_ids=e),multiple:"",placeholder:e.$t("请选择角色"),clearable:"",filterable:""},{default:_((()=>[(g(!0),h(C,null,$(s.chanCfgList,(e=>(g(),k(ee,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model"]),f("div",K,[w(o,{type:"danger",onClick:l[12]||(l[12]=e=>s.dialogVisible=!1)},{default:_((()=>[b(y(e.$t("取消")),1)])),_:1}),w(o,{type:"primary",onClick:i.confirmRole},{default:_((()=>[b(y(e.$t("确认")),1)])),_:1},8,["onClick"])])])),_:1},8,["modelValue","size","title"])])}],["__scopeId","data-v-43dcf56e"]]);export{W as default};
