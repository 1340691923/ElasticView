import{aT as e,aK as t,bW as a,bX as l,aU as s,b8 as i,c4 as o,a_ as r,c5 as n,bY as d,c6 as c,c0 as p,c1 as g,c2 as h,c3 as f,e as m,h as u,C as w,l as b,w as k,a7 as _,F as y,a3 as x,f as C,S as v,V as E,a6 as $,a5 as V,bi as L}from"./index.CLV6ek40.js";import{E as j}from"./el-loading.BUdDMhkI.js";/* empty css               */import{E as R,a as z}from"./el-select.Cgog8UO3.js";import"./el-scrollbar.JSBZHDlB.js";import"./el-popper.DN1O68l_.js";import{E as M}from"./el-pagination.D7JQcvSn.js";import{E as I}from"./el-card.BDOdcgEj.js";import{E as K,a as O}from"./el-table-column.BPgiV38a.js";import"./el-checkbox.CjSQ3F-Y.js";import{E as T}from"./el-popover.BmKUyV2Z.js";import{a as U,E as A}from"./el-form.D6tidVci.js";import{E as B}from"./el-switch.CHxKNw8v.js";import"./el-form-item.l0sNRNKZ.js";import{P as S}from"./es.BEpn2cxD.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as q}from"./index.DHrNonpr.js";import"./use-dialog.B7hCziNn.js";import"./isUndefined.DgmxjSXK.js";import"./strings.CS2wJJ2k.js";import"./index.DXxCJmyx.js";import"./_Uint8Array.DIi5Oa4y.js";import"./dropdown.OSpZgcEC.js";const F={id:0,ip:"http://127.0.0.1:9200",remark:"",version:"elasticsearch8.x",cfgIds:[]},P={class:"app-container"},W={class:"search-container"},G={class:"role-tags"},H={class:"popover-tags"},J={class:"pagination-container"};const Q=D({setup(){const s=e(),{device:i}=t(s);return{Edit:a,Delete:l,device:i}},data:()=>({input:{page:1,limit:10},count:0,esCfgOptlist:[],managerFormdialogVisible:!1,default_expand_all:!1,getListLoading:!1,usernameWord:[{value:"elastic"}],testConnectLoading:!1,connectLoading:!1,loadingMap:{},link:Object.assign({},F),list:[],dialogVisible:!1,dialogType:"new",dialogEditCfgVisible:!1,addEsCfgForm:{es_link_id:0,user:"",pwd:"",remark:"",rootpem:"",certpem:"",keypem:"",share_roles:[]},editEsCfgForm:{linkId:0,id:0,user:"",pwd:"",remark:"",rootpem:"",certpem:"",keypem:"",share_roles:[]},selectEsLinkId:0,selectEsVersion:"elasticsearch6.x",selectEsIp:"",roleMap:{},roleList:[],allRoleConfig:[],expandRowKeys:[]}),async created(){await this.getEsCfgOpt(),await this.initAllRoles(),this.getList(1)},computed:{isMobile(){return this.device===s.MOBILE}},methods:{changeVersion(){switch(this.link.version){case"elasticsearch6.x":case"elasticsearch7.x":this.link.ip="http://127.0.0.1:9200";break;case"elasticsearch8.x":this.link.ip="https://127.0.0.1:9200";break;case"mysql":this.link.ip="127.0.0.1:3306";break;case"clickhouse":this.link.ip="127.0.0.1:9000";break;case"postgres":this.link.ip="127.0.0.1:5432";break;case"mongo":this.link.ip="127.0.0.1:27017";break;case"redis":this.link.ip="127.0.0.1:6379"}},changeExpand(){this.default_expand_all?this.expandRowKeys=this.list.map((e=>e.id)):this.expandRowKeys=[]},getRowKey:e=>e.id,handleExpandChange(e,t){this.expandRowKeys=t.map((e=>e.id));let a=[];for(let l in this.expandRowKeys)a.push(this.expandRowKeys[l]);a.length==this.list.map((e=>e.id)).length&&(this.default_expand_all=!0),0==a.length&&(this.default_expand_all=!1)},async deleteEsCfgRelation(e){i.confirm("确定删除该配置吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o({id:e.row.cfg_relation_id});0==t.code?this.getList(1):r.error({type:"error",offset:60,message:t.msg})})).catch((e=>{console.error(e)}))},filterMethod:(e,t)=>t.label.indexOf(e)>-1,async getEsCfgOpt(){const e=await n();0==e.code?(null==e.data&&(e.data=[]),this.esCfgOptlist=e.data):r.error({type:"error",offset:60,message:e.msg})},async initAllRoles(){const e=await d();if(0==e.code){null==e.data&&(e.data=[]),this.roleMap={};for(let t of e.data)this.roleMap[t.id]=t.name;this.roleList=e.data}else r.error({type:"error",offset:60,message:e.msg})},testConnect(e){e.row.connectLoading=!0,S({id:e.row.cfg_relation_id,ip:e.row.ip,user:e.row.user,pwd:e.row.pwd,version:e.row.version,rootpem:e.row.rootpem,certpem:e.row.certpem,keypem:e.row.keypem,header:e.row.header}).then((t=>{e.row.connectLoading=!1,0==t.code?r.success({type:"success",offset:60,message:"连接成功"}):r.error({type:"error",offset:60,message:t.msg})})).catch((t=>{e.row.connectLoading=!1,console.log("err",t)}))},handleSizeChange(e){this.input.limit=e,this.getList(1)},async getList(e){this.input.page=e||1,this.getListLoading=!0;const t=await c({page:e,page_size:this.input.limit});if(this.getListLoading=!1,0==t.code){r.success({type:"success",offset:60,message:t.msg});for(const e in t.data.list){null==t.data.list[e].es_link_configs&&(t.data.list[e].es_link_configs=[]);for(const a in t.data.list[e].es_link_configs)t.data.list[e].es_link_configs[a].connectLoading=!1}this.count=t.data.count,this.list=t.data.list}else r.error({type:"error",offset:60,message:t.msg})},handleAddRole(){this.link=Object.assign({},F),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.link.id=e.row.id,this.link.remark=e.row.remark,this.link.version=e.row.version,this.link.ip=e.row.ip,this.link.cfgIds=[];for(let t of e.row.es_link_configs)this.link.cfgIds.push(t.id)},async deleteEsCfgAction(e){let t=await p({id:e.row.id});0==t.code?(r.success({type:"success",offset:60,message:t.msg}),this.getList()):r.error({type:"error",offset:60,message:t.msg})},handleDelete({$index:e,row:t}){i.confirm("确定删除该数据源吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await g({id:t.id});0==e.code?this.getList(1):r.error({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},async confirm(){const e="edit"===this.dialogType;if(e){const e=await h(this.link);if(0!=e.code)return void r.error({type:"error",offset:60,message:e.msg});this.getList(1)}else{const e=await f(this.link);if(0!=e.code)return void r.error({type:"error",offset:60,message:e.msg});this.getList(1)}this.dialogVisible=!1,r.success({type:"success",offset:60,message:e?"修改成功":"创建成功"})}}},[["render",function(e,t,a,l,s,i){const o=$,r=U,n=B,d=A,c=K,p=q,g=T,h=O,f=I,S=M,D=V,F=R,Q=z,X=j,Y=L;return m(),u("div",P,[w("div",W,[b(d,{inline:!0},{default:k((()=>[b(r,{label:""},{default:k((()=>[b(o,{type:"success",class:"filter-item",onClick:t[0]||(t[0]=e=>i.getList(1))},{default:k((()=>[_(y(e.$t("搜索")),1)])),_:1})])),_:1}),b(r,{label:""},{default:k((()=>[b(o,{type:"primary",class:"filter-item",onClick:i.handleAddRole},{default:k((()=>[_(y(e.$t("新建数据源")),1)])),_:1},8,["onClick"])])),_:1}),b(r,{label:e.$t("鉴权配置")},{default:k((()=>[b(n,{onChange:i.changeExpand,modelValue:s.default_expand_all,"onUpdate:modelValue":t[1]||(t[1]=e=>s.default_expand_all=e),"active-text":"展开","inactive-text":"折叠"},null,8,["onChange","modelValue"])])),_:1},8,["label"])])),_:1})]),b(f,{shadow:"never",class:"table-container"},{default:k((()=>[x((m(),C(h,{"row-key":i.getRowKey,"expand-row-keys":s.expandRowKeys,onExpandChange:i.handleExpandChange,data:s.list},{default:k((()=>[b(c,{width:"50",label:e.$t("鉴权"),type:"expand"},{default:k((t=>[b(h,{style:{width:"100%"},data:t.row.es_link_configs},{default:k((()=>[b(c,{label:e.$t("备注"),align:"center"},{default:k((e=>[_(y(e.row.remark),1)])),_:1},8,["label"]),b(c,{align:"center",label:e.$t("分配权限组"),width:"100"},{default:k((e=>[w("div",G,[e.row.share_roles.length<=2?(m(!0),u(v,{key:0},E(e.row.share_roles,(e=>(m(),C(p,{key:e},{default:k((()=>[_(y(s.roleMap[e]),1)])),_:2},1024)))),128)):(m(),u(v,{key:1},[(m(!0),u(v,null,E(e.row.share_roles.slice(0,1),(e=>(m(),C(p,{key:e},{default:k((()=>[_(y(s.roleMap[e]),1)])),_:2},1024)))),128)),b(g,{placement:"bottom",trigger:"hover",width:200,"popper-class":"role-popover"},{reference:k((()=>[b(p,{class:"more-tag"},{default:k((()=>[_(" +"+y(e.row.share_roles.length-1),1)])),_:2},1024)])),default:k((()=>[w("div",H,[(m(!0),u(v,null,E(e.row.share_roles.slice(1),(e=>(m(),C(p,{key:e,style:{"margin-left":"1rem"},size:"small"},{default:k((()=>[_(y(s.roleMap[e]),1)])),_:2},1024)))),128))])])),_:2},1024)],64))])])),_:1},8,["label"]),b(c,{align:"center",label:e.$t("用户名"),width:"300"},{default:k((e=>[_(y(e.row.user),1)])),_:1},8,["label"]),b(c,{align:"center",label:e.$t("root证书"),width:"120","show-overflow-tooltip":""},{default:k((e=>[_(y(e.row.rootpem),1)])),_:1},8,["label"]),b(c,{align:"center",label:e.$t("cert证书"),width:"120","show-overflow-tooltip":""},{default:k((e=>[_(y(e.row.certpem),1)])),_:1},8,["label"]),b(c,{align:"center",label:e.$t("key证书"),width:"120","show-overflow-tooltip":""},{default:k((e=>[_(y(e.row.keypem),1)])),_:1},8,["label"]),b(c,{align:"center",label:e.$t("操作"),fixed:"right",width:"300"},{default:k((t=>[x((m(),C(o,{disabled:t.row.connectLoading,type:"success",onClick:e=>i.testConnect(t)},{default:k((()=>[_(y(e.$t("ping")),1)])),_:2},1032,["disabled","onClick"])),[[Y,t.row.connectLoading]]),b(o,{type:"danger",onClick:e=>i.deleteEsCfgRelation(t)},{default:k((()=>[_(y(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:1},8,["label"])])),_:2},1032,["data"])])),_:1},8,["label"]),b(c,{label:e.$t("备注"),align:"center",width:"100"},{default:k((e=>[_(y(e.row.remark),1)])),_:1},8,["label"]),b(c,{align:"center",label:e.$t("数据源地址")},{default:k((e=>[_(y(e.row.ip),1)])),_:1},8,["label"]),b(c,{align:"center",label:e.$t("数据源类型"),width:"140"},{default:k((e=>[_(y(e.row.version),1)])),_:1},8,["label"]),b(c,{align:"center",width:"200",label:e.$t("创建时间")},{default:k((e=>[_(y(e.row.created),1)])),_:1},8,["label"]),b(c,{align:"center",width:"200",label:e.$t("修改时间")},{default:k((e=>[_(y(e.row.updated),1)])),_:1},8,["label"]),b(c,{align:"center",fixed:"right",label:e.$t("操作"),width:"130"},{default:k((e=>[b(o,{type:"primary",onClick:t=>i.handleEdit(e),icon:l.Edit},null,8,["onClick","icon"]),b(o,{type:"danger",icon:l.Delete,onClick:t=>i.handleDelete(e)},null,8,["icon","onClick"])])),_:1},8,["label"])])),_:1},8,["row-key","expand-row-keys","onExpandChange","data"])),[[Y,s.getListLoading]])])),_:1}),w("div",J,[b(S,{background:"","current-page":s.input.page,"page-size":s.input.limit,total:s.count,layout:i.isMobile?"pager":"total, sizes, prev, pager, next, jumper",onCurrentChange:i.getList,onSizeChange:i.handleSizeChange},null,8,["current-page","page-size","total","layout","onCurrentChange","onSizeChange"])]),b(X,{size:i.isMobile?"100%":"80%",modelValue:s.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>s.dialogVisible=e),title:"edit"===s.dialogType?e.$t("编辑数据源"):e.$t("新建数据源")},{footer:k((()=>[b(o,{type:"danger",onClick:t[6]||(t[6]=e=>s.dialogVisible=!1)},{default:k((()=>[_(y(e.$t("取消")),1)])),_:1}),b(o,{type:"primary",onClick:i.confirm},{default:k((()=>[_(y(e.$t("确认")),1)])),_:1},8,["onClick"])])),default:k((()=>[b(d,{model:s.link,"label-width":"100px","label-position":"left"},{default:k((()=>[b(r,{label:e.$t("备注")},{default:k((()=>[b(D,{clearable:"",modelValue:s.link.remark,"onUpdate:modelValue":t[2]||(t[2]=e=>s.link.remark=e),placeholder:e.$t("备注")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),b(r,{label:e.$t("数据源地址")},{default:k((()=>[b(D,{modelValue:s.link.ip,"onUpdate:modelValue":t[3]||(t[3]=e=>s.link.ip=e),placeholder:e.$t("例如:http://127.0.0.1:9200")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),b(r,{label:e.$t("数据源类型")},{default:k((()=>[b(Q,{onChange:i.changeVersion,modelValue:s.link.version,"onUpdate:modelValue":t[4]||(t[4]=e=>s.link.version=e),placeholder:e.$t("请选择数据源类型"),filterable:""},{default:k((()=>[b(F,{label:"elasticsearch6.x",value:"elasticsearch6.x"}),b(F,{label:"elasticsearch7.x",value:"elasticsearch7.x"}),b(F,{label:"elasticsearch8.x",value:"elasticsearch8.x"}),b(F,{label:"mysql",value:"mysql"}),b(F,{label:"redis",value:"redis"}),b(F,{label:"clickhouse",value:"clickhouse"}),b(F,{label:"postgres",value:"postgres"}),b(F,{label:"mongo",value:"mongo"})])),_:1},8,["onChange","modelValue","placeholder"])])),_:1},8,["label"]),b(r,{label:e.$t("鉴权列表")},{default:k((()=>[b(Q,{filterable:"",modelValue:s.link.cfgIds,"onUpdate:modelValue":t[5]||(t[5]=e=>s.link.cfgIds=e),style:{width:"150px"},"collapse-tags":"",multiple:"",placeholder:e.$t("请选择")},{default:k((()=>[(m(!0),u(v,null,E(s.esCfgOptlist,((e,t,a)=>(m(),C(F,{key:a,label:e.remark,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model"])])),_:1},8,["size","modelValue","title"])])}],["__scopeId","data-v-64f03d6f"]]);export{Q as default};
//# sourceMappingURL=link._ej8W3rj.js.map
