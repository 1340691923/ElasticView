import{d as e,r as t,o as a,e as n,h as o,C as s,l,w as c,a7 as r,j as i,g as u,p as h,aY as d,a6 as f,aU as v,aV as p}from"./index.DMBpWXpT.js";import{F as g}from"./file.CkIRLx9T.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w={class:"canvas-dom"},_=(e=>(v("data-v-1a3419bb"),e=e(),p(),e))((()=>s("h3",null,"基于canvas实现的签名组件",-1))),y=["src"],k=m(e({__name:"signature",setup(e){const v=t(""),p=t();let m,k=!1;const C=e=>{let t;if(e.offsetX){const{offsetX:a,offsetY:n}=e;t=[a,n]}else{const{top:a,left:n}=p.value.getBoundingClientRect();t=[e.touches[0].clientX-n,e.touches[0].clientY-a]}return t};let b=0,R=0;const U=e=>{[b,R]=C(e),k=!0},T=e=>{if(k){const[t,a]=C(e);!function(e,t,a,n,o){o.beginPath(),o.globalAlpha=1,o.lineWidth=2,o.strokeStyle="#000",o.moveTo(e,t),o.lineTo(a,n),o.closePath(),o.stroke()}(b,R,t,a,m),b=t,R=a}},j=()=>{k&&(k=!1)};a((()=>{m=p.value.getContext("2d")}));const x=async()=>{if(E(p.value))return void d({type:"warning",message:"当前签名文件为空"});const e=M(p.value.toDataURL(),"签名.png");if(!e)return;const t=await g.upload(e);D(),v.value=t.url},D=()=>{m.clearRect(0,0,p.value.width,p.value.height)},E=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()},L=()=>{if(E(p.value))return void d({type:"warning",message:"当前签名文件为空"});const e=document.createElement("a");e.href=p.value.toDataURL(),e.download="签名";const t=new MouseEvent("click");e.dispatchEvent(t)},M=(e,t)=>{const a=e.split(",");if(!a.length)return;const n=a[0].match(/:(.*?);/);if(n){const e=atob(a[1]);let o=e.length;const s=new Uint8Array(o);for(;o--;)s[o]=e.charCodeAt(o);return new File([s],t,{type:n[1]})}};return(e,t)=>{const a=f;return n(),o("div",w,[_,s("header",null,[l(a,{type:"primary",onClick:L},{default:c((()=>[r("保存为图片")])),_:1}),l(a,{onClick:x},{default:c((()=>[r(" 保存到后端 ")])),_:1}),l(a,{onClick:D},{default:c((()=>[r(" 清空签名 ")])),_:1})]),s("canvas",{ref_key:"canvas",ref:p,height:"200",width:"500",onMousedown:U,onMousemove:i(T,["stop","prevent"]),onMouseup:j,onTouchstart:U,onTouchmove:i(T,["stop","prevent"]),onTouchend:j},null,544),u(v)?(n(),o("img",{key:0,src:u(v),alt:"签名"},null,8,y)):h("",!0)])}}}),[["__scopeId","data-v-1a3419bb"]]);export{k as default};
