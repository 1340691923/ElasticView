import{v as e,c8 as t,d as l,c as a,b as s,r as o,g as i,K as r,e as d,f as n,w as p,h as c,i as u,F as m,p as f,k as g,a7 as h,a8 as w,_ as b,co as _,q as y,aP as C,aE as v,aU as k,bN as V,ch as $,b4 as U,cp as x,aX as j,cq as P,cr as S,cs as E,ct as L,cu as D,at as F,C as M,l as z,a3 as B,S as T,V as A,j as R,E as O,a5 as N,a6 as I,b9 as q}from"./index.W33FBolP.js";import{E as H}from"./el-loading.DTgwG8UQ.js";/* empty css               */import{E as G,a as K}from"./el-select.D5pkIrdC.js";import"./el-scrollbar.CF952IsS.js";import{a as X,u as J,E as Q}from"./el-tooltip.Dj6yvCEN.js";import{E as W}from"./el-pagination.CbGKzv28.js";import{E as Y}from"./el-card.CAShaOk8.js";import{E as Z,a as ee}from"./el-table-column.C7pSay8D.js";import"./el-checkbox.IUVBXYid.js";import{d as te,E as le,a as ae,b as se}from"./el-dropdown-item.D_ih59sR.js";import{a as oe,E as ie}from"./el-form.yboLIzGg.js";import{E as re}from"./el-switch.CDveTOpw.js";import"./el-form-item.l0sNRNKZ.js";import{d as de}from"./index.B6fdKp2E.js";import{_ as ne}from"./oauth.vue_vue_type_script_setup_true_lang.BS5A8Kkw.js";import{_ as pe}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as ce}from"./index.CwuhdP3B.js";import"./use-dialog.Uu3kEZll.js";import"./isUndefined.DgmxjSXK.js";import"./strings.Dd75Su9I.js";import"./index.BlQRGALI.js";import"./_Uint8Array.DOwfnrpH.js";import"./refs.hX0BCaP6.js";import"./el-tab-pane.DAaixt0V.js";const ue=e({trigger:X.trigger,placement:te.placement,disabled:X.disabled,visible:J.visible,transition:J.transition,popperOptions:te.popperOptions,tabindex:te.tabindex,content:J.content,popperStyle:J.popperStyle,popperClass:J.popperClass,enterable:{...J.enterable,default:!0},effect:{...J.effect,default:"light"},teleported:J.teleported,title:String,width:{type:[String,Number],default:150},offset:{type:Number,default:void 0},showAfter:{type:Number,default:0},hideAfter:{type:Number,default:200},autoClose:{type:Number,default:0},showArrow:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},"onUpdate:visible":{type:Function}}),me={"update:visible":e=>t(e),"before-enter":()=>!0,"before-leave":()=>!0,"after-enter":()=>!0,"after-leave":()=>!0},fe=l({name:"ElPopover"}),ge=l({...fe,props:ue,emits:me,setup(e,{expose:t,emit:l}){const b=e,_=a((()=>b["onUpdate:visible"])),y=s("popover"),C=o(),v=a((()=>{var e;return null==(e=i(C))?void 0:e.popperRef})),k=a((()=>[{width:r(b.width)},b.popperStyle])),V=a((()=>[y.b(),b.popperClass,{[y.m("plain")]:!!b.content}])),$=a((()=>b.transition===`${y.namespace.value}-fade-in-linear`)),U=()=>{l("before-enter")},x=()=>{l("before-leave")},j=()=>{l("after-enter")},P=()=>{l("update:visible",!1),l("after-leave")};return t({popperRef:v,hide:()=>{var e;null==(e=C.value)||e.hide()}}),(e,t)=>(d(),n(i(Q),w({ref_key:"tooltipRef",ref:C},e.$attrs,{trigger:e.trigger,placement:e.placement,disabled:e.disabled,visible:e.visible,transition:e.transition,"popper-options":e.popperOptions,tabindex:e.tabindex,content:e.content,offset:e.offset,"show-after":e.showAfter,"hide-after":e.hideAfter,"auto-close":e.autoClose,"show-arrow":e.showArrow,"aria-label":e.title,effect:e.effect,enterable:e.enterable,"popper-class":i(V),"popper-style":i(k),teleported:e.teleported,persistent:e.persistent,"gpu-acceleration":i($),"onUpdate:visible":i(_),onBeforeShow:U,onBeforeHide:x,onShow:j,onHide:P}),{content:p((()=>[e.title?(d(),c("div",{key:0,class:u(i(y).e("title")),role:"title"},m(e.title),3)):f("v-if",!0),g(e.$slots,"default",{},(()=>[h(m(e.content),1)]))])),default:p((()=>[e.$slots.reference?g(e.$slots,"reference",{key:0}):f("v-if",!0)])),_:3},16,["trigger","placement","disabled","visible","transition","popper-options","tabindex","content","offset","show-after","hide-after","auto-close","show-arrow","aria-label","effect","enterable","popper-class","popper-style","teleported","persistent","gpu-acceleration","onUpdate:visible"]))}});const he=(e,t)=>{const l=t.arg||t.value,a=null==l?void 0:l.popperRef;a&&(a.triggerRef=e)};const we=y(b(ge,[["__file","popover.vue"]]),{directive:_({mounted(e,t){he(e,t)},updated(e,t){he(e,t)}},"popover")}),be={id:"",password:"",realname:"",email:"",work_wechat_uid:"",role_ids:[],username:"",role_name:""},_e={class:"app-container"},ye={class:"role-tags"},Ce={class:"popover-tags"},ve={class:"pagination-container"},ke={style:{"text-align":"right"}};const Ve=pe({setup(){const e=C(),{device:t}=v(e);return{device:t}},data:()=>({input:{page:1,limit:10,user_name:"",real_name:"",is_ban:!1},count:0,updatePwdForm:{password:"",confirmPassword:"",id:0},pwdDialogVisible:!1,role:Object.assign({},be),routes:[],loading:!1,rolesList:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},chanCfgList:[],chanCfgMap:[],isCollapsed:!0}),computed:{isMobile(){return this.device===k.MOBILE}},async created(){await this.getRoleOpt(),this.getUserList(1)},components:{Oauth:ne},methods:{async getRoleOpt(){const e=await V();for(var t of e.data)this.chanCfgList.push(t),this.chanCfgMap[t.id]=t.name},handleSizeChange(e){this.input.limit=e,this.getUserList(1)},async getUserList(e){this.input.page=e||1,this.loading=!0;const t=await $({page:e,page_size:this.input.limit,user_name:this.input.user_name,real_name:this.input.real_name,is_ban:this.input.is_ban});this.loading=!1,this.count=t.data.count,this.rolesList=t.data.list},async submitPwdForm(){if(""==this.updatePwdForm.password)return void U.error({message:"密码不能为空",type:"error"});if(this.updatePwdForm.confirmPassword!=this.updatePwdForm.password)return void U.error({message:"两次密码输入不一致",type:"error"});const e=await x(this.updatePwdForm);0==e.code?(U.success({message:e.msg,type:"success"}),this.updatePwdForm.password="",this.updatePwdForm.confirmPassword="",this.pwdDialogVisible=!1):U.error({message:e.msg,type:"error"})},openPwdDialog(e){this.updatePwdForm.id=e.id,this.pwdDialogVisible=!0},handleAddRole(){this.role=Object.assign({},be),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.role=de(e.row),this.role.password=""},handleDelete({$index:e,row:t}){j.confirm("确认删除该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await P({id:t.id});0==e.code?(this.getUserList(1),U.success({type:"success",offset:60,message:e.msg})):U({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},SealUser({$index:e,row:t}){j.confirm("确认封禁该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await S({id:t.id});0==e.code?(this.getUserList(1),U.success({type:"success",offset:60,message:e.msg})):U({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},UnSealUser({$index:e,row:t}){j.confirm("确认解封该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await E({id:t.id});0==e.code?(this.getUserList(1),U.success({type:"success",offset:60,message:e.msg})):U({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},async confirmRole(){const e="edit"===this.dialogType;if(0==this.role.role_ids.length)return U.error({message:"角色不能为空",type:"error"}),!1;if(e){const e=await L(this.role);if(0!=e.code)return void U.error({message:e.msg,type:"error"});U.success({message:e.msg,type:"success"}),this.getUserList(1)}else{if(this.role.password.length<5&&""!=this.role.password.trim())return U.error({message:"密码长度必须大于5",type:"error"}),!1;const e=await D(this.role);if(0!=e.code)return void U.error({message:e.msg,type:"error"});U.success({message:e.msg,type:"success"}),this.getUserList(1)}this.dialogVisible=!1},toggleCollapse(){this.isCollapsed=!this.isCollapsed}}},[["render",function(e,t,l,a,s,o){const i=F("ArrowDown"),r=O,g=N,w=oe,b=re,_=I,y=ie,C=Z,v=ce,k=we,V=le,$=ae,U=se,x=ee,j=Y,P=W,S=H,E=G,L=K,D=q;return d(),c("div",_e,[M("div",{class:u(["search-container",{"is-collapsed":s.isCollapsed&&o.isMobile}])},[o.isMobile?(d(),c("div",{key:0,class:"search-header",onClick:t[0]||(t[0]=(...e)=>o.toggleCollapse&&o.toggleCollapse(...e))},[M("span",null,m(e.$t("搜索条件")),1),z(r,{class:u({"is-collapsed":s.isCollapsed})},{default:p((()=>[z(i)])),_:1},8,["class"])])):f("",!0),z(y,{inline:!0},{default:p((()=>[z(w,{label:"用户名:"},{default:p((()=>[z(g,{clearable:"",modelValue:s.input.user_name,"onUpdate:modelValue":t[1]||(t[1]=e=>s.input.user_name=e),style:{width:"200px"}},null,8,["modelValue"])])),_:1}),z(w,{label:"姓名:"},{default:p((()=>[z(g,{clearable:"",modelValue:s.input.real_name,"onUpdate:modelValue":t[2]||(t[2]=e=>s.input.real_name=e),style:{width:"200px"}},null,8,["modelValue"])])),_:1}),z(w,{label:"是否封禁:"},{default:p((()=>[z(b,{onChange:t[3]||(t[3]=e=>o.getUserList(1)),modelValue:s.input.is_ban,"onUpdate:modelValue":t[4]||(t[4]=e=>s.input.is_ban=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1}),z(w,{label:""},{default:p((()=>[z(_,{type:"success",class:"filter-item",onClick:t[5]||(t[5]=e=>o.getUserList(1))},{default:p((()=>[h(m(e.$t("查询")),1)])),_:1}),z(_,{type:"warning",class:"filter-item",onClick:o.handleAddRole},{default:p((()=>[h(m(e.$t("新增")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})],2),z(j,{shadow:"never",class:"table-container"},{default:p((()=>[B((d(),n(x,{data:s.rolesList},{default:p((()=>[z(C,{align:"center",sortable:"",label:"id",width:"50"},{default:p((e=>[h(m(e.row.id),1)])),_:1}),z(C,{align:"center",label:e.$t("用户名"),width:"100"},{default:p((e=>[h(m(e.row.username),1)])),_:1},8,["label"]),z(C,{align:"center",width:"160",label:e.$t("角色")},{default:p((e=>[M("div",ye,[e.row.role_ids.length<=2?(d(!0),c(T,{key:0},A(e.row.role_ids,(e=>(d(),n(v,{key:e},{default:p((()=>[h(m(s.chanCfgMap[e]),1)])),_:2},1024)))),128)):(d(),c(T,{key:1},[(d(!0),c(T,null,A(e.row.role_ids.slice(0,1),(e=>(d(),n(v,{key:e},{default:p((()=>[h(m(s.chanCfgMap[e]),1)])),_:2},1024)))),128)),z(k,{placement:"bottom",trigger:"hover",width:200,"popper-class":"role-popover"},{reference:p((()=>[z(v,{class:"more-tag"},{default:p((()=>[h(" +"+m(e.row.role_ids.length-1),1)])),_:2},1024)])),default:p((()=>[M("div",Ce,[(d(!0),c(T,null,A(e.row.role_ids.slice(1),(e=>(d(),n(v,{key:e,style:{"margin-left":"1rem"},size:"small"},{default:p((()=>[h(m(s.chanCfgMap[e]),1)])),_:2},1024)))),128))])])),_:2},1024)],64))])])),_:1},8,["label"]),z(C,{align:"center",width:"100",label:e.$t("姓名")},{default:p((e=>[h(m(e.row.realname),1)])),_:1},8,["label"]),z(C,{align:"center",width:"200",label:e.$t("电子邮箱")},{default:p((e=>[h(m(e.row.email),1)])),_:1},8,["label"]),z(C,{align:"center",width:"100",label:e.$t("企微成员UserID")},{default:p((e=>[h(m(e.row.work_wechat_uid),1)])),_:1},8,["label"]),z(C,{align:"center",sortable:"",width:"180",label:e.$t("创建时间")},{default:p((e=>[h(m(e.row.create_time),1)])),_:1},8,["label"]),z(C,{align:"center",sortable:"",width:"180",label:e.$t("修改时间")},{default:p((e=>[h(m(e.row.update_time),1)])),_:1},8,["label"]),z(C,{align:"center",sortable:"",width:"180",label:e.$t("最后登录时间")},{default:p((e=>[h(m(e.row.last_login_time),1)])),_:1},8,["label"]),z(C,{align:"center",label:e.$t("操作"),fixed:"right",width:o.isMobile?80:400},{default:p((t=>[o.isMobile?(d(),n(U,{key:1,trigger:"click"},{dropdown:p((()=>[z($,null,{default:p((()=>[z(V,{command:"1"},{default:p((()=>[z(_,{type:"primary",onClick:R((e=>o.handleEdit(t)),["stop"])},{default:p((()=>[h(m(e.$t("编辑")),1)])),_:2},1032,["onClick"])])),_:2},1024),z(V,null,{default:p((()=>[z(_,{type:"info",onClick:e=>o.openPwdDialog(t.row)},{default:p((()=>[h(m(e.$t("重置密码")),1)])),_:2},1032,["onClick"])])),_:2},1024),z(V,null,{default:p((()=>[1==t.row.is_ban?(d(),n(_,{key:0,type:"primary",onClick:e=>o.UnSealUser(t)},{default:p((()=>[h(m(e.$t("解封")),1)])),_:2},1032,["onClick"])):f("",!0),0==t.row.is_ban?(d(),n(_,{key:1,type:"danger",onClick:e=>o.SealUser(t)},{default:p((()=>[h(m(e.$t("封禁")),1)])),_:2},1032,["onClick"])):f("",!0)])),_:2},1024),z(V,null,{default:p((()=>[z(_,{type:"danger",onClick:e=>o.handleDelete(t)},{default:p((()=>[h(m(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:p((()=>[z(_,null,{default:p((()=>[h("管理")])),_:1})])),_:2},1024)):(d(),c(T,{key:0},[z(_,{type:"primary",onClick:e=>o.handleEdit(t)},{default:p((()=>[h(m(e.$t("编辑")),1)])),_:2},1032,["onClick"]),z(_,{type:"info",onClick:e=>o.openPwdDialog(t.row)},{default:p((()=>[h(m(e.$t("重置密码")),1)])),_:2},1032,["onClick"]),1==t.row.is_ban?(d(),n(_,{key:0,type:"primary",onClick:e=>o.UnSealUser(t)},{default:p((()=>[h(m(e.$t("解封")),1)])),_:2},1032,["onClick"])):f("",!0),0==t.row.is_ban?(d(),n(_,{key:1,type:"danger",onClick:e=>o.SealUser(t)},{default:p((()=>[h(m(e.$t("封禁")),1)])),_:2},1032,["onClick"])):f("",!0),z(_,{type:"danger",onClick:e=>o.handleDelete(t)},{default:p((()=>[h(m(e.$t("删除")),1)])),_:2},1032,["onClick"])],64))])),_:1},8,["label","width"])])),_:1},8,["data"])),[[D,s.loading]])])),_:1}),M("div",ve,[z(P,{background:"","current-page":s.input.page,"page-size":s.input.limit,total:s.count,onCurrentChange:o.getUserList,onSizeChange:o.handleSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])]),z(S,{title:"修改密码",modelValue:s.pwdDialogVisible,"onUpdate:modelValue":t[9]||(t[9]=e=>s.pwdDialogVisible=e),size:o.isMobile?"100%":"50%"},{footer:p((()=>[z(_,{onClick:t[8]||(t[8]=e=>s.pwdDialogVisible=!1)},{default:p((()=>[h("取消")])),_:1}),z(_,{type:"primary",onClick:o.submitPwdForm},{default:p((()=>[h("修改")])),_:1},8,["onClick"])])),default:p((()=>[z(y,{"label-width":"100px"},{default:p((()=>[z(w,{label:"新密码",required:""},{default:p((()=>[z(g,{modelValue:s.updatePwdForm.password,"onUpdate:modelValue":t[6]||(t[6]=e=>s.updatePwdForm.password=e),"show-password":"",type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])])),_:1}),z(w,{label:"确认密码",required:""},{default:p((()=>[z(g,{modelValue:s.updatePwdForm.confirmPassword,"onUpdate:modelValue":t[7]||(t[7]=e=>s.updatePwdForm.confirmPassword=e),"show-password":"",type:"password",placeholder:"请再次输入新密码"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","size"]),z(S,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[17]||(t[17]=e=>s.dialogVisible=e),size:o.isMobile?"100%":"50%",title:"edit"===s.dialogType?e.$t("编辑用户信息"):e.$t("新建用户信息")},{default:p((()=>[z(y,{model:s.role,"label-width":"100px","label-position":"left"},{default:p((()=>[z(w,{label:e.$t("用户名")},{default:p((()=>[z(g,{modelValue:s.role.username,"onUpdate:modelValue":t[10]||(t[10]=e=>s.role.username=e),placeholder:e.$t("用户名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),"edit"!==s.dialogType?(d(),n(w,{key:0,label:e.$t("密码")},{default:p((()=>[z(g,{"show-password":"",type:"password",modelValue:s.role.password,"onUpdate:modelValue":t[11]||(t[11]=e=>s.role.password=e),placeholder:e.$t("不填则为系统自动生成")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):f("",!0),z(w,{label:e.$t("姓名")},{default:p((()=>[z(g,{modelValue:s.role.realname,"onUpdate:modelValue":t[12]||(t[12]=e=>s.role.realname=e),placeholder:e.$t("姓名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),z(w,{label:e.$t("电子邮箱")},{default:p((()=>[z(g,{modelValue:s.role.email,"onUpdate:modelValue":t[13]||(t[13]=e=>s.role.email=e),placeholder:e.$t("电子邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),z(w,{label:e.$t("企微UserID")},{default:p((()=>[z(g,{modelValue:s.role.work_wechat_uid,"onUpdate:modelValue":t[14]||(t[14]=e=>s.role.work_wechat_uid=e),placeholder:e.$t("企业微信成员UserID。对应管理端的账号，企业内必须唯一")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),z(w,{label:e.$t("请选择角色")},{default:p((()=>[z(L,{modelValue:s.role.role_ids,"onUpdate:modelValue":t[15]||(t[15]=e=>s.role.role_ids=e),multiple:"",placeholder:e.$t("请选择角色"),clearable:"",filterable:""},{default:p((()=>[(d(!0),c(T,null,A(s.chanCfgList,(e=>(d(),n(E,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model"]),M("div",ke,[z(_,{type:"danger",onClick:t[16]||(t[16]=e=>s.dialogVisible=!1)},{default:p((()=>[h(m(e.$t("取消")),1)])),_:1}),z(_,{type:"primary",onClick:o.confirmRole},{default:p((()=>[h(m(e.$t("确认")),1)])),_:1},8,["onClick"])])])),_:1},8,["modelValue","size","title"])])}],["__scopeId","data-v-f02617fe"]]);export{Ve as default};
//# sourceMappingURL=user.tTcL-RZ-.js.map
