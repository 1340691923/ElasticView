import{e,h as l,C as a,d as t,r as o,a0 as i,J as s,o as r,l as n,w as u,g as d,a4 as m,a7 as p,a3 as c,f,aB as v,p as g,F as h,aY as _,aP as y,dY as b,a5 as j,a6 as k,bc as w}from"./index.DMBpWXpT.js";/* empty css                   */import{E as V}from"./el-drawer.CpqknkfB.js";import{E as x}from"./el-tree.UTBgh5GW.js";import{E as C}from"./el-checkbox.8MJHthul.js";import"./el-tooltip.l0sNRNKZ.js";import{E}from"./el-popper.Cb3Eus9m.js";import{_ as U}from"./question-filled.8tGWrj00.js";import{E as z}from"./el-dialog.DGaSOiRM.js";import{E as S}from"./el-input-number.zcrW3MHJ.js";import{E as q,a as R}from"./el-radio.B-TDguQR.js";/* empty css               */import{E as L,a as B}from"./el-select.C9ddzdnq.js";import"./el-scrollbar.BJ_tYB1D.js";import{E as F}from"./el-card.BhvZLWwX.js";import{_ as M}from"./index.DCoBgS8Y.js";import{E as N,a as A}from"./el-table-column.Dl1jn1Bd.js";import{_ as O,a as P}from"./delete.CrlEmVes.js";import{_ as T}from"./plus.BhbEy4-l.js";import{E as H,a as D}from"./el-form.DUR-mZNt.js";import{_ as I}from"./refresh.BxJIPU5v.js";import{_ as K}from"./search.DdQbLJWh.js";import"./el-form-item.l0sNRNKZ.js";import{R as Y}from"./role.BVYrj-EL.js";import{E as J}from"./index.qeCV5ckY.js";import"./use-dialog.CoOh9qjD.js";import"./isUndefined.DgmxjSXK.js";import"./token.DWNpOE8r.js";import"./isEqual.B61-3bNT.js";import"./_Uint8Array.BEOPqGcx.js";import"./refs.BiRbkTK3.js";import"./index.tvUbLRs9.js";import"./strings.DeQ3Zoz4.js";import"./debounce.l44evi-0.js";import"./index.CP01f_MK.js";import"./castArray.arHVDzqw.js";import"./el-pagination.CQTA1hq1.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";const Q={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},W=[a("path",{fill:"currentColor",d:"M118.656 438.656a32 32 0 0 1 0-45.248L416 96l4.48-3.776A32 32 0 0 1 461.248 96l3.712 4.48a32.064 32.064 0 0 1-3.712 40.832L218.56 384H928a32 32 0 1 1 0 64H141.248a32 32 0 0 1-22.592-9.344M64 608a32 32 0 0 1 32-32h786.752a32 32 0 0 1 22.656 54.592L608 928l-4.48 3.776a32.064 32.064 0 0 1-40.832-49.024L805.632 640H96a32 32 0 0 1-32-32"},null,-1)];const X={name:"ep-switch",render:function(a,t){return e(),l("svg",Q,[...W])}},$={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},G=[a("path",{fill:"currentColor",d:"m249.6 417.088l319.744 43.072l39.168 310.272L845.12 178.88zm-129.024 47.168a32 32 0 0 1-7.68-61.44l777.792-311.04a32 32 0 0 1 41.6 41.6l-310.336 775.68a32 32 0 0 1-61.44-7.808L512 516.992z"},null,-1)];const Z={name:"ep-position",render:function(a,t){return e(),l("svg",$,[...G])}},ee={class:"app-container"},le={class:"search-container"},ae={class:"dialog-footer"},te={class:"flex-x-between"},oe={class:"flex-center"},ie={class:"dialog-footer"},se=t({name:"Role",inheritAttrs:!1,__name:"index",setup(t){const Q=o(H),W=o(H),$=o(),G=o(!1),se=o([]),re=o(0),ne=i({pageNum:1,pageSize:10}),ue=o(),de=o([]),me=i({title:"",visible:!1}),pe=i({sort:1,status:1,code:"",name:""}),ce=i({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),fe=o({}),ve=o(!1),ge=o(""),he=o(!0),_e=o(!0);function ye(){G.value=!0,Y.getPage(ne).then((e=>{ue.value=e.list,re.value=e.total})).finally((()=>{G.value=!1}))}function be(){Q.value.resetFields(),ne.pageNum=1,ye()}function je(e){se.value=e.map((e=>e.id))}function ke(e){me.visible=!0,e?(me.title="修改角色",Y.getFormData(e).then((e=>{Object.assign(pe,e)}))):me.title="新增角色"}function we(){W.value.validate((e=>{if(e){G.value=!0;const e=pe.id;e?Y.update(e,pe).then((()=>{_.success("修改成功"),Ve(),be()})).finally((()=>G.value=!1)):Y.add(pe).then((()=>{_.success("新增成功"),Ve(),be()})).finally((()=>G.value=!1))}}))}function Ve(){me.visible=!1,W.value.resetFields(),W.value.clearValidate(),pe.id=void 0,pe.sort=1,pe.status=1}function xe(e){const l=[e||se.value].join(",");l?y.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{G.value=!0,Y.deleteByIds(l).then((()=>{_.success("删除成功"),be()})).finally((()=>G.value=!1))}),(()=>{_.info("已取消删除")})):_.warning("请勾选删除项")}function Ce(){const e=fe.value.id;if(e){const l=$.value.getCheckedNodes(!1,!0).map((e=>e.value));G.value=!0,Y.updateRoleMenus(e,l).then((()=>{_.success("分配权限成功"),ve.value=!1,be()})).finally((()=>{G.value=!1}))}}function Ee(){he.value=!he.value,$.value&&Object.values($.value.store.nodesMap).forEach((e=>{he.value?e.expand():e.collapse()}))}function Ue(e,l){return!e||l.label.includes(e)}function ze(e){_e.value=e}return s(ge,(e=>{$.value.filter(e)})),r((()=>{ye()})),(t,o)=>{const i=j,s=D,r=K,_=k,y=I,Se=H,qe=T,Re=O,Le=N,Be=J,Fe=Z,Me=P,Ne=A,Ae=M,Oe=F,Pe=L,Te=B,He=q,De=R,Ie=S,Ke=z,Ye=X,Je=C,Qe=U,We=E,Xe=x,$e=V,Ge=w;return e(),l("div",ee,[a("div",le,[n(Se,{ref_key:"queryFormRef",ref:Q,model:d(ne),inline:!0},{default:u((()=>[n(s,{prop:"keywords",label:"关键字"},{default:u((()=>[n(i,{modelValue:d(ne).keywords,"onUpdate:modelValue":o[0]||(o[0]=e=>d(ne).keywords=e),placeholder:"角色名称",clearable:"",onKeyup:m(ye,["enter"])},null,8,["modelValue"])])),_:1}),n(s,null,{default:u((()=>[n(_,{type:"primary",onClick:ye},{default:u((()=>[n(r),p("搜索")])),_:1}),n(_,{onClick:be},{default:u((()=>[n(y),p("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),n(Oe,{shadow:"never",class:"table-container"},{header:u((()=>[n(_,{type:"success",onClick:o[1]||(o[1]=e=>ke())},{default:u((()=>[n(qe),p("新增")])),_:1}),n(_,{type:"danger",disabled:0===d(se).length,onClick:o[2]||(o[2]=e=>xe())},{default:u((()=>[n(Re),p("删除")])),_:1},8,["disabled"])])),default:u((()=>[c((e(),f(Ne,{ref:"dataTableRef",data:d(ue),"highlight-current-row":"",border:"",onSelectionChange:je},{default:u((()=>[n(Le,{type:"selection",width:"55",align:"center"}),n(Le,{label:"角色名称",prop:"name","min-width":"100"}),n(Le,{label:"角色编码",prop:"code",width:"150"}),n(Le,{label:"状态",align:"center",width:"100"},{default:u((l=>[1===l.row.status?(e(),f(Be,{key:0,type:"success"},{default:u((()=>[p("正常")])),_:1})):(e(),f(Be,{key:1,type:"info"},{default:u((()=>[p("禁用")])),_:1}))])),_:1}),n(Le,{label:"排序",align:"center",width:"80",prop:"sort"}),n(Le,{fixed:"right",label:"操作",width:"220"},{default:u((e=>[n(_,{type:"primary",size:"small",link:"",onClick:l=>async function(e){const l=e.id;l&&(ve.value=!0,G.value=!0,fe.value.id=l,fe.value.name=e.name,de.value=await b.getOptions(),Y.getRoleMenuIds(l).then((e=>{e.forEach((e=>$.value.setChecked(e,!0,!1)))})).finally((()=>{G.value=!1})))}(e.row)},{default:u((()=>[n(Fe),p("分配权限 ")])),_:2},1032,["onClick"]),n(_,{type:"primary",size:"small",link:"",onClick:l=>ke(e.row.id)},{default:u((()=>[n(Me),p("编辑 ")])),_:2},1032,["onClick"]),n(_,{type:"danger",size:"small",link:"",onClick:l=>xe(e.row.id)},{default:u((()=>[n(Re),p("删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Ge,d(G)]]),d(re)>0?(e(),f(Ae,{key:0,total:d(re),"onUpdate:total":o[3]||(o[3]=e=>v(re)?re.value=e:null),page:d(ne).pageNum,"onUpdate:page":o[4]||(o[4]=e=>d(ne).pageNum=e),limit:d(ne).pageSize,"onUpdate:limit":o[5]||(o[5]=e=>d(ne).pageSize=e),onPagination:ye},null,8,["total","page","limit"])):g("",!0)])),_:1}),n(Ke,{modelValue:d(me).visible,"onUpdate:modelValue":o[11]||(o[11]=e=>d(me).visible=e),title:d(me).title,width:"500px",onClose:Ve},{footer:u((()=>[a("div",ae,[n(_,{type:"primary",onClick:we},{default:u((()=>[p("确 定")])),_:1}),n(_,{onClick:Ve},{default:u((()=>[p("取 消")])),_:1})])])),default:u((()=>[n(Se,{ref_key:"roleFormRef",ref:W,model:d(pe),rules:d(ce),"label-width":"100px"},{default:u((()=>[n(s,{label:"角色名称",prop:"name"},{default:u((()=>[n(i,{modelValue:d(pe).name,"onUpdate:modelValue":o[6]||(o[6]=e=>d(pe).name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),n(s,{label:"角色编码",prop:"code"},{default:u((()=>[n(i,{modelValue:d(pe).code,"onUpdate:modelValue":o[7]||(o[7]=e=>d(pe).code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])])),_:1}),n(s,{label:"数据权限",prop:"dataScope"},{default:u((()=>[n(Te,{modelValue:d(pe).dataScope,"onUpdate:modelValue":o[8]||(o[8]=e=>d(pe).dataScope=e)},{default:u((()=>[(e(),f(Pe,{key:0,label:"全部数据",value:0})),(e(),f(Pe,{key:1,label:"部门及子部门数据",value:1})),(e(),f(Pe,{key:2,label:"本部门数据",value:2})),(e(),f(Pe,{key:3,label:"本人数据",value:3}))])),_:1},8,["modelValue"])])),_:1}),n(s,{label:"状态",prop:"status"},{default:u((()=>[n(De,{modelValue:d(pe).status,"onUpdate:modelValue":o[9]||(o[9]=e=>d(pe).status=e)},{default:u((()=>[n(He,{label:1},{default:u((()=>[p("正常")])),_:1}),n(He,{label:0},{default:u((()=>[p("停用")])),_:1})])),_:1},8,["modelValue"])])),_:1}),n(s,{label:"排序",prop:"sort"},{default:u((()=>[n(Ie,{modelValue:d(pe).sort,"onUpdate:modelValue":o[10]||(o[10]=e=>d(pe).sort=e),"controls-position":"right",min:0,style:{width:"100px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),n($e,{modelValue:d(ve),"onUpdate:modelValue":o[15]||(o[15]=e=>v(ve)?ve.value=e:null),title:"【"+d(fe).name+"】权限分配",size:"500"},{footer:u((()=>[a("div",ie,[n(_,{type:"primary",onClick:Ce},{default:u((()=>[p("确 定")])),_:1}),n(_,{onClick:o[14]||(o[14]=e=>ve.value=!1)},{default:u((()=>[p("取 消")])),_:1})])])),default:u((()=>[a("div",te,[n(i,{modelValue:d(ge),"onUpdate:modelValue":o[12]||(o[12]=e=>v(ge)?ge.value=e:null),clearable:"",class:"w-[200px]",placeholder:"菜单权限名称"},{prefix:u((()=>[n(r)])),_:1},8,["modelValue"]),a("div",oe,[n(_,{type:"primary",size:"small",plain:"",onClick:Ee},{default:u((()=>[n(Ye),p(h(d(he)?"收缩":"展开"),1)])),_:1}),n(Je,{modelValue:d(_e),"onUpdate:modelValue":o[13]||(o[13]=e=>v(_e)?_e.value=e:null),onChange:ze,class:"ml-5"},{default:u((()=>[p("父子联动 ")])),_:1},8,["modelValue"]),n(We,{placement:"bottom"},{content:u((()=>[p(" 如果只需勾选菜单权限，不需要勾选子菜单或者按钮权限，请关闭父子联动 ")])),default:u((()=>[n(Qe,{class:"ml-1 color-[--el-color-primary] inline-block cursor-pointer"})])),_:1})])]),n(Xe,{ref_key:"permTreeRef",ref:$,"node-key":"value","show-checkbox":"",data:d(de),"filter-node-method":Ue,"default-expand-all":!0,"check-strictly":!d(_e),class:"mt-5"},{default:u((({data:e})=>[p(h(e.label),1)])),_:1},8,["data","check-strictly"])])),_:1},8,["modelValue","title"])])}}});export{se as default};
