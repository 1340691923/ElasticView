import{aQ as e,aH as a,bI as l,bJ as t,aV as i,aY as s,bT as o,b5 as n,bU as r,bL as d,bV as c,bP as p,bQ as g,bR as h,bS as m,e as u,h as f,C as b,l as w,w as k,a7 as _,F as y,a3 as x,f as C,S as v,V,a6 as L,a5 as $,ba as E}from"./index.DhFaMfT1.js";/* empty css                   */import{E as j}from"./el-drawer.DcGaWt7a.js";/* empty css               */import{a as R,E as I}from"./el-select.KghQrqPV.js";import"./el-scrollbar.aDuaURpM.js";import"./el-tooltip.DNk7uouO.js";import{E as O}from"./el-pagination.Brn4GqVi.js";import{E as T}from"./el-card.DLuvqNHd.js";import{E as z,a as K}from"./el-table-column.DooLdcCD.js";import"./el-checkbox.KVZb2vWH.js";import{a as M,E as U}from"./el-form.DQSmj6L_.js";import{E as S}from"./el-switch.CkWz4UzV.js";import"./el-form-item.l0sNRNKZ.js";import{P as A}from"./es.DupDuRw_.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as D}from"./index.BDgBryKB.js";import"./use-dialog.dDo3P1Pb.js";import"./isUndefined.DgmxjSXK.js";import"./strings.BIH3i9Us.js";import"./index.DdIe-2Yd.js";import"./_Uint8Array.DfkEojHH.js";const F={id:0,ip:"http://127.0.0.1:9200",remark:"",version:"elasticsearch8.x",cfgIds:[]},q={class:"app-container"},H={class:"search-container"},P={class:"pagination-container"};const Q=B({setup(){const i=e(),{device:s}=a(i);return{Edit:l,Delete:t,device:s}},data:()=>({input:{page:1,limit:10},count:0,esCfgOptlist:[],managerFormdialogVisible:!1,default_expand_all:!1,getListLoading:!1,usernameWord:[{value:"elastic"}],testConnectLoading:!1,connectLoading:!1,loadingMap:{},link:Object.assign({},F),list:[],dialogVisible:!1,dialogType:"new",dialogEditCfgVisible:!1,addEsCfgForm:{es_link_id:0,user:"",pwd:"",remark:"",rootpem:"",certpem:"",keypem:"",share_roles:[]},editEsCfgForm:{linkId:0,id:0,user:"",pwd:"",remark:"",rootpem:"",certpem:"",keypem:"",share_roles:[]},selectEsLinkId:0,selectEsVersion:"elasticsearch6.x",selectEsIp:"",roleMap:{},roleList:[],allRoleConfig:[],expandRowKeys:[]}),async created(){await this.getEsCfgOpt(),await this.initAllRoles(),this.getList(1)},computed:{isMobile(){return this.device===i.MOBILE}},methods:{changeVersion(){switch(this.link.version){case"elasticsearch6.x":case"elasticsearch7.x":this.link.ip="http://127.0.0.1:9200";break;case"elasticsearch8.x":this.link.ip="https://127.0.0.1:9200";break;case"mysql":this.link.ip="127.0.0.1:3306";break;case"clickhouse":this.link.ip="127.0.0.1:9000";break;case"postgres":this.link.ip="127.0.0.1:5432";break;case"mongo":this.link.ip="127.0.0.1:27017";break;case"redis":this.link.ip="127.0.0.1:6379"}},changeExpand(){this.default_expand_all?this.expandRowKeys=this.list.map((e=>e.id)):this.expandRowKeys=[]},getRowKey:e=>e.id,handleExpandChange(e,a){this.expandRowKeys=a.map((e=>e.id));let l=[];for(let t in this.expandRowKeys)l.push(this.expandRowKeys[t]);l.length==this.list.map((e=>e.id)).length&&(this.default_expand_all=!0),0==l.length&&(this.default_expand_all=!1)},async deleteEsCfgRelation(e){s.confirm("确定删除该配置吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a=await o({id:e.row.cfg_relation_id});0==a.code?this.getList(1):n.error({type:"error",message:a.msg})})).catch((e=>{console.error(e)}))},filterMethod:(e,a)=>a.label.indexOf(e)>-1,async getEsCfgOpt(){const e=await r();0==e.code?(null==e.data&&(e.data=[]),this.esCfgOptlist=e.data):n.error({type:"error",message:e.msg})},async initAllRoles(){const e=await d();if(0==e.code){null==e.data&&(e.data=[]),this.roleMap={};for(let a of e.data)this.roleMap[a.id]=a.name;this.roleList=e.data}else n.error({type:"error",message:e.msg})},testConnect(e){e.row.connectLoading=!0,A({id:e.row.cfg_relation_id,ip:e.row.ip,user:e.row.user,pwd:e.row.pwd,version:e.row.version,rootpem:e.row.rootpem,certpem:e.row.certpem,keypem:e.row.keypem,header:e.row.header}).then((a=>{e.row.connectLoading=!1,0==a.code?n.success({type:"success",message:"连接成功"}):n.error({type:"error",message:a.msg})})).catch((a=>{e.row.connectLoading=!1,console.log("err",a)}))},handleSizeChange(e){this.input.limit=e,this.getList(1)},async getList(e){this.input.page=e||1,this.getListLoading=!0;const a=await c({page:e,page_size:this.input.limit});if(this.getListLoading=!1,0==a.code){n.success({type:"success",message:a.msg});for(const e in a.data.list){null==a.data.list[e].es_link_configs&&(a.data.list[e].es_link_configs=[]);for(const l in a.data.list[e].es_link_configs)a.data.list[e].es_link_configs[l].connectLoading=!1}this.count=a.data.count,this.list=a.data.list}else n.error({type:"error",message:a.msg})},handleAddRole(){this.link=Object.assign({},F),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.link.id=e.row.id,this.link.remark=e.row.remark,this.link.version=e.row.version,this.link.ip=e.row.ip,this.link.cfgIds=[];for(let a of e.row.es_link_configs)this.link.cfgIds.push(a.id)},async deleteEsCfgAction(e){let a=await p({id:e.row.id});0==a.code?(n.success({type:"success",message:a.msg}),this.getList()):n.error({type:"error",message:a.msg})},handleDelete({$index:e,row:a}){s.confirm("确定删除该数据源吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await g({id:a.id});0==e.code?this.getList(1):n.error({type:"error",message:e.msg})})).catch((e=>{console.error(e)}))},async confirm(){const e="edit"===this.dialogType;if(e){const e=await h(this.link);if(0!=e.code)return void n.error({type:"error",message:e.msg});this.getList(1)}else{const e=await m(this.link);if(0!=e.code)return void n.error({type:"error",message:e.msg});this.getList(1)}this.dialogVisible=!1,n.success({type:"success",message:e?"修改成功":"创建成功"})}}},[["render",function(e,a,l,t,i,s){const o=L,n=M,r=S,d=U,c=z,p=D,g=K,h=T,m=O,A=$,B=R,F=I,Q=j,G=E;return u(),f("div",q,[b("div",H,[w(d,{inline:!0},{default:k((()=>[w(n,{label:""},{default:k((()=>[w(o,{type:"success",class:"filter-item",onClick:a[0]||(a[0]=e=>s.getList(1))},{default:k((()=>[_(y(e.$t("搜索")),1)])),_:1})])),_:1}),w(n,{label:""},{default:k((()=>[w(o,{type:"primary",class:"filter-item",onClick:s.handleAddRole},{default:k((()=>[_(y(e.$t("新建数据源")),1)])),_:1},8,["onClick"])])),_:1}),w(n,{label:e.$t("鉴权配置")},{default:k((()=>[w(r,{onChange:s.changeExpand,modelValue:i.default_expand_all,"onUpdate:modelValue":a[1]||(a[1]=e=>i.default_expand_all=e),"active-text":"展开","inactive-text":"折叠"},null,8,["onChange","modelValue"])])),_:1},8,["label"])])),_:1})]),w(h,{shadow:"never",class:"table-container"},{default:k((()=>[x((u(),C(g,{"row-key":s.getRowKey,"expand-row-keys":i.expandRowKeys,onExpandChange:s.handleExpandChange,data:i.list},{default:k((()=>[w(c,{width:"50",label:e.$t("鉴权"),type:"expand"},{default:k((a=>[w(g,{style:{width:"100%"},data:a.row.es_link_configs},{default:k((()=>[w(c,{label:e.$t("备注"),align:"center"},{default:k((e=>[_(y(e.row.remark),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("已分配角色"),width:"400"},{default:k((e=>[(u(!0),f(v,null,V(e.row.share_roles,((e,a)=>(u(),C(p,null,{default:k((()=>[_(y(i.roleMap[e]),1)])),_:2},1024)))),256))])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("用户名"),width:"300"},{default:k((e=>[_(y(e.row.user),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("root证书"),width:"120","show-overflow-tooltip":""},{default:k((e=>[_(y(e.row.rootpem),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("cert证书"),width:"120","show-overflow-tooltip":""},{default:k((e=>[_(y(e.row.certpem),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("key证书"),width:"120","show-overflow-tooltip":""},{default:k((e=>[_(y(e.row.keypem),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("操作"),fixed:"right",width:"300"},{default:k((a=>[x((u(),C(o,{disabled:a.row.connectLoading,type:"success",onClick:e=>s.testConnect(a)},{default:k((()=>[_(y(e.$t("ping")),1)])),_:2},1032,["disabled","onClick"])),[[G,a.row.connectLoading]]),w(o,{type:"danger",onClick:e=>s.deleteEsCfgRelation(a)},{default:k((()=>[_(y(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:1},8,["label"])])),_:2},1032,["data"])])),_:1},8,["label"]),w(c,{label:e.$t("备注"),align:"center",width:"100"},{default:k((e=>[_(y(e.row.remark),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("连接地址")},{default:k((e=>[_(y(e.row.ip),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("数据源类型"),width:"140"},{default:k((e=>[_(y(e.row.version),1)])),_:1},8,["label"]),w(c,{align:"center",width:"200",label:e.$t("创建时间")},{default:k((e=>[_(y(e.row.created),1)])),_:1},8,["label"]),w(c,{align:"center",width:"200",label:e.$t("修改时间")},{default:k((e=>[_(y(e.row.updated),1)])),_:1},8,["label"]),w(c,{align:"center",fixed:"right",label:e.$t("操作"),width:"130"},{default:k((e=>[w(o,{type:"primary",onClick:a=>s.handleEdit(e),icon:t.Edit},null,8,["onClick","icon"]),w(o,{type:"danger",icon:t.Delete,onClick:a=>s.handleDelete(e)},null,8,["icon","onClick"])])),_:1},8,["label"])])),_:1},8,["row-key","expand-row-keys","onExpandChange","data"])),[[G,i.getListLoading]])])),_:1}),b("div",P,[w(m,{background:"","current-page":i.input.page,"page-size":i.input.limit,total:i.count,onCurrentChange:s.getList,onSizeChange:s.handleSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])]),w(Q,{size:s.isMobile?"100%":"80%",modelValue:i.dialogVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>i.dialogVisible=e),title:"edit"===i.dialogType?e.$t("编辑数据源"):e.$t("新建数据源")},{footer:k((()=>[w(o,{type:"danger",onClick:a[6]||(a[6]=e=>i.dialogVisible=!1)},{default:k((()=>[_(y(e.$t("取消")),1)])),_:1}),w(o,{type:"primary",onClick:s.confirm},{default:k((()=>[_(y(e.$t("确认")),1)])),_:1},8,["onClick"])])),default:k((()=>[w(d,{model:i.link,"label-width":"100px","label-position":"left"},{default:k((()=>[w(n,{label:e.$t("备注")},{default:k((()=>[w(A,{clearable:"",modelValue:i.link.remark,"onUpdate:modelValue":a[2]||(a[2]=e=>i.link.remark=e),placeholder:e.$t("备注")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),w(n,{label:e.$t("连接地址")},{default:k((()=>[w(A,{modelValue:i.link.ip,"onUpdate:modelValue":a[3]||(a[3]=e=>i.link.ip=e),placeholder:e.$t("例如:http://127.0.0.1:9200")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),w(n,{label:e.$t("数据源类型")},{default:k((()=>[w(F,{onChange:s.changeVersion,modelValue:i.link.version,"onUpdate:modelValue":a[4]||(a[4]=e=>i.link.version=e),placeholder:e.$t("请选择数据源类型"),filterable:""},{default:k((()=>[w(B,{label:"elasticsearch6.x",value:"elasticsearch6.x"}),w(B,{label:"elasticsearch7.x",value:"elasticsearch7.x"}),w(B,{label:"elasticsearch8.x",value:"elasticsearch8.x"}),w(B,{label:"mysql",value:"mysql"}),w(B,{label:"redis",value:"redis"}),w(B,{label:"clickhouse",value:"clickhouse"}),w(B,{label:"postgres",value:"postgres"}),w(B,{label:"mongo",value:"mongo"})])),_:1},8,["onChange","modelValue","placeholder"])])),_:1},8,["label"]),w(n,{label:e.$t("鉴权列表")},{default:k((()=>[w(F,{filterable:"",modelValue:i.link.cfgIds,"onUpdate:modelValue":a[5]||(a[5]=e=>i.link.cfgIds=e),style:{width:"150px"},"collapse-tags":"",multiple:"",placeholder:e.$t("请选择")},{default:k((()=>[(u(!0),f(v,null,V(i.esCfgOptlist,((e,a,l)=>(u(),C(B,{key:l,label:e.remark,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model"])])),_:1},8,["size","modelValue","title"])])}]]);export{Q as default};
