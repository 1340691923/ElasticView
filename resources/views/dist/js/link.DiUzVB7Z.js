import{bz as e,aY as l,bA as a,br as t,bB as s,bv as i,aP as o,bw as r,bx as n,by as d,e as c,h as p,C as g,l as m,w as h,a7 as u,F as f,a3 as w,f as b,S as _,V as k,a6 as y,a5 as x,bc as C}from"./index.DMBpWXpT.js";/* empty css                   */import{E as $}from"./el-drawer.CpqknkfB.js";/* empty css               */import{E as v,a as V}from"./el-select.C9ddzdnq.js";import"./el-scrollbar.BJ_tYB1D.js";import"./el-popper.Cb3Eus9m.js";import{E as j}from"./el-card.BhvZLWwX.js";import{E,a as L}from"./el-table-column.Dl1jn1Bd.js";import"./el-checkbox.8MJHthul.js";import"./el-tooltip.l0sNRNKZ.js";import{a as R,E as K}from"./el-form.DUR-mZNt.js";import{E as O}from"./el-switch.BvIaL9AI.js";import"./el-form-item.l0sNRNKZ.js";import{P as U}from"./es.Bcp-0uIV.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as I}from"./index.qeCV5ckY.js";import"./use-dialog.CoOh9qjD.js";import"./isUndefined.DgmxjSXK.js";import"./token.DWNpOE8r.js";import"./strings.DeQ3Zoz4.js";import"./isEqual.B61-3bNT.js";import"./_Uint8Array.BEOPqGcx.js";import"./debounce.l44evi-0.js";import"./index.CP01f_MK.js";import"./castArray.arHVDzqw.js";const M={id:0,ip:"http://127.0.0.1:9200",remark:"",version:"elasticsearch8.x",cfgIds:[]},T={class:"app-container"},F={class:"search-container"};const S=A({data:()=>({esCfgOptlist:[],managerFormdialogVisible:!1,default_expand_all:!1,getListLoading:!1,usernameWord:[{value:"elastic"}],testConnectLoading:!1,connectLoading:!1,loadingMap:{},link:Object.assign({},M),list:[],dialogVisible:!1,dialogType:"new",dialogEditCfgVisible:!1,addEsCfgForm:{es_link_id:0,user:"",pwd:"",remark:"",rootpem:"",certpem:"",keypem:"",share_roles:[]},editEsCfgForm:{linkId:0,id:0,user:"",pwd:"",remark:"",rootpem:"",certpem:"",keypem:"",share_roles:[]},selectEsLinkId:0,selectEsVersion:"elasticsearch6.x",selectEsIp:"",roleMap:{},roleList:[],allRoleConfig:[],expandRowKeys:[]}),async created(){await this.getEsCfgOpt(),await this.initAllRoles(),this.getList()},methods:{changeExpand(){this.default_expand_all?this.expandRowKeys=this.list.map((e=>e.id)):this.expandRowKeys=[]},getRowKey:e=>e.id,handleExpandChange(e,l){this.expandRowKeys=l.map((e=>e.id));let a=[];for(let t in this.expandRowKeys)a.push(this.expandRowKeys[t]);a.length==this.list.map((e=>e.id)).length&&(this.default_expand_all=!0),0==a.length&&(this.default_expand_all=!1)},async deleteEsCfgRelation(a){const t=await e({id:a.row.cfg_relation_id});0==t.code?this.getList():l.error({type:"error",message:t.msg})},filterMethod:(e,l)=>l.label.indexOf(e)>-1,async getEsCfgOpt(){const e=await a();0==e.code?(null==e.data&&(e.data=[]),this.esCfgOptlist=e.data):l.error({type:"error",message:e.msg})},async initAllRoles(){const e=await t();if(0==e.code){null==e.data&&(e.data=[]),this.roleMap={};for(let l of e.data)this.roleMap[l.id]=l.name;this.roleList=e.data}else l.error({type:"error",message:e.msg})},testConnect(e){e.row.connectLoading=!0,U({id:e.row.cfg_relation_id,ip:e.row.ip,user:e.row.user,pwd:e.row.pwd,version:e.row.version,rootpem:e.row.rootpem,certpem:e.row.certpem,keypem:e.row.keypem,header:e.row.header}).then((a=>{e.row.connectLoading=!1,0==a.code?l.success({type:"success",message:"连接成功"}):l.error({type:"error",message:a.msg})})).catch((l=>{e.row.connectLoading=!1,console.log("err",l)}))},async getList(){this.getListLoading=!0;const e=await s();if(this.getListLoading=!1,0==e.code){l.success({type:"success",message:e.msg});for(const l in e.data){null==e.data[l].es_link_configs&&(e.data[l].es_link_configs=[]);for(const a in e.data[l].es_link_configs)e.data[l].es_link_configs[a].connectLoading=!1}this.list=e.data}else l.error({type:"error",message:e.msg})},handleAddRole(){this.link=Object.assign({},M),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.link.id=e.row.id,this.link.remark=e.row.remark,this.link.version=e.row.version,this.link.ip=e.row.ip,this.link.cfgIds=[];for(let l of e.row.es_link_configs)this.link.cfgIds.push(l.id)},async deleteEsCfgAction(e){let a=await i({id:e.row.id});0==a.code?(l.success({type:"success",message:a.msg}),this.getList()):l.error({type:"error",message:a.msg})},handleDelete({$index:e,row:a}){o.confirm("确定删除该连接信息吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await r({id:a.id});0==e.code?this.getList():l.error({type:"error",message:e.msg})})).catch((e=>{console.error(e)}))},async confirm(){const e="edit"===this.dialogType;if(e){const e=await n(this.link);if(0!=e.code)return void l.error({type:"error",message:e.msg});this.getList()}else{const e=await d(this.link);if(0!=e.code)return void l.error({type:"error",message:e.msg});this.getList()}this.dialogVisible=!1,l.success({type:"success",message:e?"修改成功":"创建成功"})}}},[["render",function(e,l,a,t,s,i){const o=y,r=R,n=O,d=K,U=E,A=I,M=L,S=j,q=x,B=v,z=V,D=$,P=C;return c(),p("div",T,[g("div",F,[m(d,{inline:!0},{default:h((()=>[m(r,{label:""},{default:h((()=>[m(o,{type:"success",class:"filter-item",onClick:i.getList},{default:h((()=>[u(f(e.$t("搜索")),1)])),_:1},8,["onClick"])])),_:1}),m(r,{label:""},{default:h((()=>[m(o,{type:"primary",class:"filter-item",onClick:i.handleAddRole},{default:h((()=>[u(f(e.$t("新建连接信息")),1)])),_:1},8,["onClick"])])),_:1}),m(r,{label:e.$t("ES鉴权配置")},{default:h((()=>[m(n,{onChange:i.changeExpand,modelValue:s.default_expand_all,"onUpdate:modelValue":l[0]||(l[0]=e=>s.default_expand_all=e),"active-text":"展开","inactive-text":"折叠"},null,8,["onChange","modelValue"])])),_:1},8,["label"])])),_:1})]),m(S,{shadow:"never",class:"table-container"},{default:h((()=>[w((c(),b(M,{"row-key":i.getRowKey,"expand-row-keys":s.expandRowKeys,onExpandChange:i.handleExpandChange,data:s.list},{default:h((()=>[m(U,{width:"100",label:e.$t("鉴权配置"),type:"expand"},{default:h((l=>[m(M,{style:{width:"100%"},data:l.row.es_link_configs},{default:h((()=>[m(U,{label:e.$t("备注"),align:"center"},{default:h((e=>[u(f(e.row.remark),1)])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("已分配角色"),width:"400"},{default:h((e=>[(c(!0),p(_,null,k(e.row.share_roles,((e,l)=>(c(),b(A,null,{default:h((()=>[u(f(s.roleMap[e]),1)])),_:2},1024)))),256))])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("用户名"),width:"300"},{default:h((e=>[u(f(e.row.user),1)])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("root证书"),width:"120","show-overflow-tooltip":""},{default:h((e=>[u(f(e.row.rootpem),1)])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("cert证书"),width:"120","show-overflow-tooltip":""},{default:h((e=>[u(f(e.row.certpem),1)])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("key证书"),width:"120","show-overflow-tooltip":""},{default:h((e=>[u(f(e.row.keypem),1)])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("操作"),fixed:"right",width:"300"},{default:h((l=>[w((c(),b(o,{disabled:l.row.connectLoading,type:"success",onClick:e=>i.testConnect(l)},{default:h((()=>[u(f(e.$t("ping")),1)])),_:2},1032,["disabled","onClick"])),[[P,l.row.connectLoading]]),m(o,{type:"danger",onClick:e=>i.deleteEsCfgRelation(l)},{default:h((()=>[u(f(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:1},8,["label"])])),_:2},1032,["data"])])),_:1},8,["label"]),m(U,{label:e.$t("备注"),align:"center",width:"100"},{default:h((e=>[u(f(e.row.remark),1)])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("连接地址")},{default:h((e=>[u(f(e.row.ip),1)])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("数据源类型"),width:"100"},{default:h((e=>[u(f(e.row.version),1)])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("创建时间")},{default:h((e=>[u(f(e.row.created),1)])),_:1},8,["label"]),m(U,{align:"center",label:e.$t("修改时间")},{default:h((e=>[u(f(e.row.updated),1)])),_:1},8,["label"]),m(U,{align:"center",fixed:"right",label:e.$t("操作"),width:"200"},{default:h((l=>[m(o,{type:"primary",onClick:e=>i.handleEdit(l)},{default:h((()=>[u(f(e.$t("编辑")),1)])),_:2},1032,["onClick"]),m(o,{type:"danger",onClick:e=>i.handleDelete(l)},{default:h((()=>[u(f(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:1},8,["label"])])),_:1},8,["row-key","expand-row-keys","onExpandChange","data"])),[[P,s.getListLoading]])])),_:1}),m(D,{size:"80%",modelValue:s.dialogVisible,"onUpdate:modelValue":l[6]||(l[6]=e=>s.dialogVisible=e),title:"edit"===s.dialogType?e.$t("编辑连接信息"):e.$t("新建连接信息")},{footer:h((()=>[m(o,{type:"danger",onClick:l[5]||(l[5]=e=>s.dialogVisible=!1)},{default:h((()=>[u(f(e.$t("取消")),1)])),_:1}),m(o,{type:"primary",onClick:i.confirm},{default:h((()=>[u(f(e.$t("确认")),1)])),_:1},8,["onClick"])])),default:h((()=>[m(d,{model:s.link,"label-width":"200px","label-position":"left"},{default:h((()=>[m(r,{label:e.$t("备注")},{default:h((()=>[m(q,{clearable:"",modelValue:s.link.remark,"onUpdate:modelValue":l[1]||(l[1]=e=>s.link.remark=e),placeholder:e.$t("备注")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),m(r,{label:e.$t("连接地址")},{default:h((()=>[m(q,{modelValue:s.link.ip,"onUpdate:modelValue":l[2]||(l[2]=e=>s.link.ip=e),placeholder:e.$t("例如:http://127.0.0.1:9200")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),m(r,{label:e.$t("数据源类型")},{default:h((()=>[m(z,{modelValue:s.link.version,"onUpdate:modelValue":l[3]||(l[3]=e=>s.link.version=e),placeholder:e.$t("请选择数据源类型"),filterable:""},{default:h((()=>[m(B,{label:"elasticsearch6.x",value:"elasticsearch6.x"}),m(B,{label:"elasticsearch7.x",value:"elasticsearch7.x"}),m(B,{label:"elasticsearch8.x",value:"elasticsearch8.x"}),m(B,{label:"mysql",value:"mysql"}),m(B,{label:"redis",value:"redis"}),m(B,{label:"clickhouse",value:"clickhouse"}),m(B,{label:"postgres",value:"postgres"}),m(B,{label:"mongo",value:"mongo"})])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),m(r,{label:e.$t("鉴权列表")},{default:h((()=>[m(z,{filterable:"",modelValue:s.link.cfgIds,"onUpdate:modelValue":l[4]||(l[4]=e=>s.link.cfgIds=e),style:{width:"150px"},"collapse-tags":"",multiple:"",placeholder:e.$t("请选择")},{default:h((()=>[(c(!0),p(_,null,k(s.esCfgOptlist,((e,l,a)=>(c(),b(B,{key:a,label:e.remark,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}]]);export{S as default};
