import{d as e,aW as a,r as l,c as t,a0 as s,o as i,h as r,C as n,l as o,w as u,i as d,a3 as c,aa as p,bK as v,a2 as m,a_ as f,E as b,e as _,g,a9 as y,a4 as w,a7 as h,f as k,F as j,p as S,S as C,b1 as z,b2 as E,bL as x,a$ as V,a5 as $,a6 as M,bi as U}from"./index.CLV6ek40.js";import{E as A}from"./el-loading.BUdDMhkI.js";import{E as F,a as L}from"./el-descriptions-item.CcvJ47Sc.js";import{E as R}from"./el-card.BDOdcgEj.js";import{E as T}from"./el-pagination.D7JQcvSn.js";/* empty css               */import{E as D,a as H}from"./el-select.Cgog8UO3.js";import"./el-scrollbar.JSBZHDlB.js";import"./el-popper.DN1O68l_.js";import{E as K,a as N}from"./el-table-column.BPgiV38a.js";import"./el-checkbox.CjSQ3F-Y.js";import{E as q,a as I}from"./el-form.D6tidVci.js";import"./el-form-item.l0sNRNKZ.js";import{E as W}from"./index.DHrNonpr.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./use-dialog.B7hCziNn.js";import"./isUndefined.DgmxjSXK.js";import"./strings.CS2wJJ2k.js";import"./index.DXxCJmyx.js";import"./_Uint8Array.DIi5Oa4y.js";const G={class:"app-container"},J={class:"search-container"},P=(e=>(z("data-v-a170a9bd"),e=e(),E(),e))((()=>n("span",null,"筛选条件",-1))),Q={key:0,class:"pagination-container"},Y={class:"drawer-content"},O={class:"description-value"},X={class:"description-value"},Z={class:"description-value"},ee={class:"description-value"},ae={class:"description-value"},le=["innerHTML"],te={class:"drawer-footer"},se=B(e({name:"Notice",inheritAttrs:!1,__name:"index",setup(e){const z=a(),E=l(),B=l(!1),se=l(0),ie=l(),re=t((()=>window.innerWidth<768)),ne=l(re.value);function oe(){ne.value=!ne.value}const ue=s({title:"",read_type:2,page:1,page_size:10}),de=l([]),ce=s(new Map),pe=t((()=>Array.from(ce.keys()))),ve=s({visible:!1}),me=l({});async function fe(){const e=await x({});if(0==e.code)return f.success(e.msg),void be();f.error(e.msg)}async function be(){try{B.value=!0;const e=await v(ue);0===e.code?(de.value=e.data.list,se.value=e.data.count,m((()=>{ie.value&&(ie.value.clearSelection(),de.value.forEach((e=>{ce.has(e.id)&&ie.value.toggleRowSelection(e,!0)})))}))):f.error(e.msg||"获取通知列表失败")}catch(e){console.error("获取通知列表失败:",e),f.error("获取通知列表失败")}finally{B.value=!1}}function _e(e){const a=new Date(e);if(isNaN(a.getTime()))return"无效日期";return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`}function ge(){E.value.resetFields(),ue.page=1,be()}function ye(e){ue.page_size=e,be()}function we(e){ue.page=e,be()}const he=l(!1);async function ke(e){he.value=!0,await z.markAsRead(e),he.value=!1,e.forEach((e=>ce.delete(e))),be()}function je(e){e.forEach((e=>{ce.set(e.id,e)}))}function Se(){ve.visible=!1,me.value={}}return i((()=>{be(),window.addEventListener("resize",(()=>{re.value&&(ne.value=!0)}))})),(e,a)=>{const l=b,t=$,s=I,i=D,v=H,m=M,f=q,z=K,x=W,ce=N,Ce=T,ze=R,Ee=F,xe=L,Ve=A,$e=U;return _(),r("div",G,[n("div",J,[n("div",{class:"search-header",onClick:oe},[P,o(l,{class:d(["toggle-icon",{"is-active":!ne.value}])},{default:u((()=>[o(g(y))])),_:1},8,["class"])]),c(o(f,{ref_key:"queryFormRef",ref:E,model:ue,inline:!0,"label-suffix":":","label-width":"auto",class:"search-form"},{default:u((()=>[o(s,{label:"标题",prop:"title"},{default:u((()=>[o(t,{modelValue:ue.title,"onUpdate:modelValue":a[0]||(a[0]=e=>ue.title=e),placeholder:"标题",clearable:"",onKeyup:w(be,["enter"])},null,8,["modelValue"])])),_:1}),o(s,{label:"阅读状态",prop:"read_type"},{default:u((()=>[o(v,{style:{width:"10rem"},modelValue:ue.read_type,"onUpdate:modelValue":a[1]||(a[1]=e=>ue.read_type=e),placeholder:"请选择阅读状态",clearable:""},{default:u((()=>[o(i,{label:"全部",value:0}),o(i,{label:"未读",value:2}),o(i,{label:"已读",value:1})])),_:1},8,["modelValue"])])),_:1}),o(s,{class:"search-buttons"},{default:u((()=>[n("div",{class:d(["button-group",{"mobile-buttons":re.value}])},[o(m,{type:"primary",icon:"search",onClick:be},{default:u((()=>[h("搜索")])),_:1}),o(m,{icon:"refresh",onClick:ge},{default:u((()=>[h("重置")])),_:1}),o(m,{type:"danger",onClick:fe},{default:u((()=>[h("清空消息")])),_:1}),c((_(),k(m,{disabled:0==pe.value.length,onClick:a[2]||(a[2]=e=>ke(pe.value))},{default:u((()=>[h("标为已读")])),_:1},8,["disabled"])),[[$e,he.value]])],2)])),_:1})])),_:1},8,["model"]),[[p,!ne.value]])]),o(ze,{shadow:"hover",class:"data-table"},{default:u((()=>[c((_(),k(ce,{ref_key:"dataTableRef",ref:ie,"row-key":e=>e.id,data:de.value,class:"data-table__content",onSelectionChange:je,"max-height":"500"},{default:u((()=>[o(z,{type:"selection",width:"55",align:"center"}),o(z,{label:"通知标题",prop:"title","min-width":"200"}),re.value?S("",!0):(_(),k(z,{key:0,align:"center",label:"通知类型",width:"150"},{default:u((e=>[o(x,{type:e.row.level},{default:u((()=>[h(j(e.row.type),1)])),_:2},1032,["type"])])),_:1})),re.value?S("",!0):(_(),k(z,{key:1,align:"center",label:"来源",prop:"source",width:"150"})),o(z,{align:"center",label:"阅读状态",width:"100"},{default:u((e=>[o(x,{type:e.row.is_read?"success":"warning"},{default:u((()=>[h(j(e.row.is_read?"已读":"未读"),1)])),_:2},1032,["type"])])),_:1}),re.value?S("",!0):(_(),k(z,{key:2,label:"发布时间",width:"180"},{default:u((e=>[n("span",null,j(_e(e.row.created)),1)])),_:1})),o(z,{align:"center",fixed:"right",label:"操作",width:"150"},{default:u((e=>[o(m,{type:"primary",size:"small",link:"",onClick:a=>{return l=e.row,me.value=l,ve.visible=!0,void(l.is_read||ke([l.id]));var l}},{default:u((()=>[h(" 详情 ")])),_:2},1032,["onClick"]),e.row.btn_jump_url?(_(),k(m,{key:0,size:"small",link:"",onClick:a=>{return l=e.row.btn_jump_type,t=e.row.btn_jump_url,void("internal"===l?V.push({path:t}):window.open(t,"_blank"));var l,t}},{default:u((()=>[""!=e.row.btn_desc?(_(),r(C,{key:0},[h(j(e.row.btn_desc),1)],64)):(_(),r(C,{key:1},[h(" 跳转 ")],64))])),_:2},1032,["onClick"])):S("",!0)])),_:1})])),_:1},8,["row-key","data"])),[[$e,B.value]]),se.value>0?(_(),r("div",Q,[o(Ce,{background:"","current-page":ue.page,"page-size":ue.page_size,"page-sizes":[10,20,30,50,100,200,500],total:se.value,layout:re.value?"pager":"total, sizes, prev, pager, next, jumper",onSizeChange:ye,onCurrentChange:we},null,8,["current-page","page-size","total","layout"])])):S("",!0)])),_:1}),o(Ve,{"append-to-body":"",modelValue:ve.visible,"onUpdate:modelValue":a[3]||(a[3]=e=>ve.visible=e),title:me.value.title,size:re.value?"90%":"50%",direction:"rtl",class:"notice-drawer","before-close":Se},{default:u((()=>[n("div",Y,[o(xe,{column:1,border:""},{default:u((()=>[o(Ee,{width:"10px",label:"标题","label-class-name":"description-label"},{default:u((()=>[n("span",O,j(me.value.title),1)])),_:1}),o(Ee,{label:"类型","label-class-name":"description-label"},{default:u((()=>[o(x,{type:me.value.level,class:"notice-tag"},{default:u((()=>[h(j(me.value.type),1)])),_:1},8,["type"])])),_:1}),o(Ee,{label:"来源","label-class-name":"description-label"},{default:u((()=>[n("span",X,j(me.value.source||"无"),1)])),_:1}),o(Ee,{label:"通知影响范围","label-class-name":"description-label"},{default:u((()=>[n("span",Z,["all"==me.value.target_type?(_(),r(C,{key:0},[h("全部用户")],64)):S("",!0),"roles"==me.value.target_type?(_(),r(C,{key:1},[h("指定权限组")],64)):S("",!0),"users"==me.value.target_type?(_(),r(C,{key:2},[h("指定用户")],64)):S("",!0)])])),_:1}),o(Ee,{label:"是否定时任务","label-class-name":"description-label"},{default:u((()=>[n("span",ee,j(1==me.value.is_task?"是":"否"),1)])),_:1}),o(Ee,{label:"发布时间","label-class-name":"description-label"},{default:u((()=>[n("span",ae,j(_e(me.value.created)),1)])),_:1}),o(Ee,{label:"内容","label-class-name":"description-label"},{default:u((()=>[n("div",{class:"notice-content",innerHTML:me.value.content},null,8,le)])),_:1})])),_:1}),n("div",te,[o(m,{type:"primary",onClick:Se,class:"close-button"},{default:u((()=>[h(" 关闭 ")])),_:1})])])])),_:1},8,["modelValue","title","size"])])}}}),[["__scopeId","data-v-a170a9bd"]]);export{se as default};
//# sourceMappingURL=index.BfBF_ReV.js.map
