import{aQ as e,aH as t,bJ as a,bK as l,aV as i,aY as s,bU as o,b5 as n,bV as r,bM as d,bW as c,bQ as p,bR as g,bS as h,bT as f,e as m,h as u,C as b,l as w,w as k,a7 as _,F as y,a3 as x,f as C,S as v,V,a6 as $,a5 as E,ba as L}from"./index.CeDXPVSD.js";/* empty css                   */import{E as j}from"./el-drawer.ZfVaGiZ0.js";/* empty css               */import{a as R,E as K}from"./el-select.CuqbsI_Z.js";import"./el-scrollbar.C0SjPjve.js";import"./el-tooltip.DeOoh3S_.js";import{E as M}from"./el-pagination.BD64g3b9.js";import{E as O}from"./el-card.Cx8qXsER.js";import{E as T,a as z}from"./el-table-column.u_VJJ4LY.js";import"./el-checkbox.D4z8pLqr.js";import{a as I,E as U}from"./el-form.CyAu9Gll.js";import{E as S}from"./el-switch.DZq8KFyg.js";import"./el-form-item.l0sNRNKZ.js";import{P as A}from"./es.J2h64tdr.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as D}from"./index.CWr3KaP0.js";import"./use-dialog.DWl0CYH9.js";import"./isUndefined.DgmxjSXK.js";import"./strings.DM4HtHVe.js";import"./index.H2r2dG6H.js";import"./_Uint8Array.4jrYBpH3.js";const F={id:0,ip:"http://127.0.0.1:9200",remark:"",version:"elasticsearch8.x",cfgIds:[]},q={class:"app-container"},H={class:"search-container"},Q={class:"pagination-container"};const W=B({setup(){const i=e(),{device:s}=t(i);return{Edit:a,Delete:l,device:s}},data:()=>({input:{page:1,limit:10},count:0,esCfgOptlist:[],managerFormdialogVisible:!1,default_expand_all:!1,getListLoading:!1,usernameWord:[{value:"elastic"}],testConnectLoading:!1,connectLoading:!1,loadingMap:{},link:Object.assign({},F),list:[],dialogVisible:!1,dialogType:"new",dialogEditCfgVisible:!1,addEsCfgForm:{es_link_id:0,user:"",pwd:"",remark:"",rootpem:"",certpem:"",keypem:"",share_roles:[]},editEsCfgForm:{linkId:0,id:0,user:"",pwd:"",remark:"",rootpem:"",certpem:"",keypem:"",share_roles:[]},selectEsLinkId:0,selectEsVersion:"elasticsearch6.x",selectEsIp:"",roleMap:{},roleList:[],allRoleConfig:[],expandRowKeys:[]}),async created(){await this.getEsCfgOpt(),await this.initAllRoles(),this.getList(1)},computed:{isMobile(){return this.device===i.MOBILE}},methods:{changeVersion(){switch(this.link.version){case"elasticsearch6.x":case"elasticsearch7.x":this.link.ip="http://127.0.0.1:9200";break;case"elasticsearch8.x":this.link.ip="https://127.0.0.1:9200";break;case"mysql":this.link.ip="127.0.0.1:3306";break;case"clickhouse":this.link.ip="127.0.0.1:9000";break;case"postgres":this.link.ip="127.0.0.1:5432";break;case"mongo":this.link.ip="127.0.0.1:27017";break;case"redis":this.link.ip="127.0.0.1:6379"}},changeExpand(){this.default_expand_all?this.expandRowKeys=this.list.map((e=>e.id)):this.expandRowKeys=[]},getRowKey:e=>e.id,handleExpandChange(e,t){this.expandRowKeys=t.map((e=>e.id));let a=[];for(let l in this.expandRowKeys)a.push(this.expandRowKeys[l]);a.length==this.list.map((e=>e.id)).length&&(this.default_expand_all=!0),0==a.length&&(this.default_expand_all=!1)},async deleteEsCfgRelation(e){s.confirm("确定删除该配置吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o({id:e.row.cfg_relation_id});0==t.code?this.getList(1):n.error({type:"error",offset:60,message:t.msg})})).catch((e=>{console.error(e)}))},filterMethod:(e,t)=>t.label.indexOf(e)>-1,async getEsCfgOpt(){const e=await r();0==e.code?(null==e.data&&(e.data=[]),this.esCfgOptlist=e.data):n.error({type:"error",offset:60,message:e.msg})},async initAllRoles(){const e=await d();if(0==e.code){null==e.data&&(e.data=[]),this.roleMap={};for(let t of e.data)this.roleMap[t.id]=t.name;this.roleList=e.data}else n.error({type:"error",offset:60,message:e.msg})},testConnect(e){e.row.connectLoading=!0,A({id:e.row.cfg_relation_id,ip:e.row.ip,user:e.row.user,pwd:e.row.pwd,version:e.row.version,rootpem:e.row.rootpem,certpem:e.row.certpem,keypem:e.row.keypem,header:e.row.header}).then((t=>{e.row.connectLoading=!1,0==t.code?n.success({type:"success",offset:60,message:"连接成功"}):n.error({type:"error",offset:60,message:t.msg})})).catch((t=>{e.row.connectLoading=!1,console.log("err",t)}))},handleSizeChange(e){this.input.limit=e,this.getList(1)},async getList(e){this.input.page=e||1,this.getListLoading=!0;const t=await c({page:e,page_size:this.input.limit});if(this.getListLoading=!1,0==t.code){n.success({type:"success",offset:60,message:t.msg});for(const e in t.data.list){null==t.data.list[e].es_link_configs&&(t.data.list[e].es_link_configs=[]);for(const a in t.data.list[e].es_link_configs)t.data.list[e].es_link_configs[a].connectLoading=!1}this.count=t.data.count,this.list=t.data.list}else n.error({type:"error",offset:60,message:t.msg})},handleAddRole(){this.link=Object.assign({},F),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.link.id=e.row.id,this.link.remark=e.row.remark,this.link.version=e.row.version,this.link.ip=e.row.ip,this.link.cfgIds=[];for(let t of e.row.es_link_configs)this.link.cfgIds.push(t.id)},async deleteEsCfgAction(e){let t=await p({id:e.row.id});0==t.code?(n.success({type:"success",offset:60,message:t.msg}),this.getList()):n.error({type:"error",offset:60,message:t.msg})},handleDelete({$index:e,row:t}){s.confirm("确定删除该数据源吗?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await g({id:t.id});0==e.code?this.getList(1):n.error({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},async confirm(){const e="edit"===this.dialogType;if(e){const e=await h(this.link);if(0!=e.code)return void n.error({type:"error",offset:60,message:e.msg});this.getList(1)}else{const e=await f(this.link);if(0!=e.code)return void n.error({type:"error",offset:60,message:e.msg});this.getList(1)}this.dialogVisible=!1,n.success({type:"success",offset:60,message:e?"修改成功":"创建成功"})}}},[["render",function(e,t,a,l,i,s){const o=$,n=I,r=S,d=U,c=T,p=D,g=z,h=O,f=M,A=E,B=R,F=K,W=j,G=L;return m(),u("div",q,[b("div",H,[w(d,{inline:!0},{default:k((()=>[w(n,{label:""},{default:k((()=>[w(o,{type:"success",class:"filter-item",onClick:t[0]||(t[0]=e=>s.getList(1))},{default:k((()=>[_(y(e.$t("搜索")),1)])),_:1})])),_:1}),w(n,{label:""},{default:k((()=>[w(o,{type:"primary",class:"filter-item",onClick:s.handleAddRole},{default:k((()=>[_(y(e.$t("新建数据源")),1)])),_:1},8,["onClick"])])),_:1}),w(n,{label:e.$t("鉴权配置")},{default:k((()=>[w(r,{onChange:s.changeExpand,modelValue:i.default_expand_all,"onUpdate:modelValue":t[1]||(t[1]=e=>i.default_expand_all=e),"active-text":"展开","inactive-text":"折叠"},null,8,["onChange","modelValue"])])),_:1},8,["label"])])),_:1})]),w(h,{shadow:"never",class:"table-container"},{default:k((()=>[x((m(),C(g,{"row-key":s.getRowKey,"expand-row-keys":i.expandRowKeys,onExpandChange:s.handleExpandChange,data:i.list},{default:k((()=>[w(c,{width:"50",label:e.$t("鉴权"),type:"expand"},{default:k((t=>[w(g,{style:{width:"100%"},data:t.row.es_link_configs},{default:k((()=>[w(c,{label:e.$t("备注"),align:"center"},{default:k((e=>[_(y(e.row.remark),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("已分配角色"),width:"400"},{default:k((e=>[(m(!0),u(v,null,V(e.row.share_roles,((e,t)=>(m(),C(p,null,{default:k((()=>[_(y(i.roleMap[e]),1)])),_:2},1024)))),256))])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("用户名"),width:"300"},{default:k((e=>[_(y(e.row.user),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("root证书"),width:"120","show-overflow-tooltip":""},{default:k((e=>[_(y(e.row.rootpem),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("cert证书"),width:"120","show-overflow-tooltip":""},{default:k((e=>[_(y(e.row.certpem),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("key证书"),width:"120","show-overflow-tooltip":""},{default:k((e=>[_(y(e.row.keypem),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("操作"),fixed:"right",width:"300"},{default:k((t=>[x((m(),C(o,{disabled:t.row.connectLoading,type:"success",onClick:e=>s.testConnect(t)},{default:k((()=>[_(y(e.$t("ping")),1)])),_:2},1032,["disabled","onClick"])),[[G,t.row.connectLoading]]),w(o,{type:"danger",onClick:e=>s.deleteEsCfgRelation(t)},{default:k((()=>[_(y(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:1},8,["label"])])),_:2},1032,["data"])])),_:1},8,["label"]),w(c,{label:e.$t("备注"),align:"center",width:"100"},{default:k((e=>[_(y(e.row.remark),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("连接地址")},{default:k((e=>[_(y(e.row.ip),1)])),_:1},8,["label"]),w(c,{align:"center",label:e.$t("数据源类型"),width:"140"},{default:k((e=>[_(y(e.row.version),1)])),_:1},8,["label"]),w(c,{align:"center",width:"200",label:e.$t("创建时间")},{default:k((e=>[_(y(e.row.created),1)])),_:1},8,["label"]),w(c,{align:"center",width:"200",label:e.$t("修改时间")},{default:k((e=>[_(y(e.row.updated),1)])),_:1},8,["label"]),w(c,{align:"center",fixed:"right",label:e.$t("操作"),width:"130"},{default:k((e=>[w(o,{type:"primary",onClick:t=>s.handleEdit(e),icon:l.Edit},null,8,["onClick","icon"]),w(o,{type:"danger",icon:l.Delete,onClick:t=>s.handleDelete(e)},null,8,["icon","onClick"])])),_:1},8,["label"])])),_:1},8,["row-key","expand-row-keys","onExpandChange","data"])),[[G,i.getListLoading]])])),_:1}),b("div",Q,[w(f,{background:"","current-page":i.input.page,"page-size":i.input.limit,total:i.count,onCurrentChange:s.getList,onSizeChange:s.handleSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])]),w(W,{size:s.isMobile?"100%":"80%",modelValue:i.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>i.dialogVisible=e),title:"edit"===i.dialogType?e.$t("编辑数据源"):e.$t("新建数据源")},{footer:k((()=>[w(o,{type:"danger",onClick:t[6]||(t[6]=e=>i.dialogVisible=!1)},{default:k((()=>[_(y(e.$t("取消")),1)])),_:1}),w(o,{type:"primary",onClick:s.confirm},{default:k((()=>[_(y(e.$t("确认")),1)])),_:1},8,["onClick"])])),default:k((()=>[w(d,{model:i.link,"label-width":"100px","label-position":"left"},{default:k((()=>[w(n,{label:e.$t("备注")},{default:k((()=>[w(A,{clearable:"",modelValue:i.link.remark,"onUpdate:modelValue":t[2]||(t[2]=e=>i.link.remark=e),placeholder:e.$t("备注")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),w(n,{label:e.$t("连接地址")},{default:k((()=>[w(A,{modelValue:i.link.ip,"onUpdate:modelValue":t[3]||(t[3]=e=>i.link.ip=e),placeholder:e.$t("例如:http://127.0.0.1:9200")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),w(n,{label:e.$t("数据源类型")},{default:k((()=>[w(F,{onChange:s.changeVersion,modelValue:i.link.version,"onUpdate:modelValue":t[4]||(t[4]=e=>i.link.version=e),placeholder:e.$t("请选择数据源类型"),filterable:""},{default:k((()=>[w(B,{label:"elasticsearch6.x",value:"elasticsearch6.x"}),w(B,{label:"elasticsearch7.x",value:"elasticsearch7.x"}),w(B,{label:"elasticsearch8.x",value:"elasticsearch8.x"}),w(B,{label:"mysql",value:"mysql"}),w(B,{label:"redis",value:"redis"}),w(B,{label:"clickhouse",value:"clickhouse"}),w(B,{label:"postgres",value:"postgres"}),w(B,{label:"mongo",value:"mongo"})])),_:1},8,["onChange","modelValue","placeholder"])])),_:1},8,["label"]),w(n,{label:e.$t("鉴权列表")},{default:k((()=>[w(F,{filterable:"",modelValue:i.link.cfgIds,"onUpdate:modelValue":t[5]||(t[5]=e=>i.link.cfgIds=e),style:{width:"150px"},"collapse-tags":"",multiple:"",placeholder:e.$t("请选择")},{default:k((()=>[(m(!0),u(v,null,V(i.esCfgOptlist,((e,t,a)=>(m(),C(B,{key:a,label:e.remark,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model"])])),_:1},8,["size","modelValue","title"])])}]]);export{W as default};
