import{aQ as e,aH as l,aV as a,bM as t,cb as s,b5 as o,cj as i,aY as r,ck as d,cl as n,cm as u,cn as c,co as p,e as m,h as g,C as h,l as f,w,a7 as _,F as b,a3 as y,f as V,S as k,V as C,p as $,j as U,a5 as j,a6 as x,ba as P}from"./index.CeDXPVSD.js";/* empty css                   *//* empty css               */import{a as v,E as L}from"./el-select.CuqbsI_Z.js";import"./el-scrollbar.C0SjPjve.js";import"./el-tooltip.DeOoh3S_.js";import{E as D}from"./el-drawer.ZfVaGiZ0.js";import{E as F}from"./el-pagination.BD64g3b9.js";import{E}from"./el-card.Cx8qXsER.js";import{E as S,a as T}from"./el-table-column.u_VJJ4LY.js";import"./el-checkbox.D4z8pLqr.js";import{E as z,a as M,b as B}from"./el-dropdown-item.9z9DRQCW.js";import{a as O,E as R}from"./el-form.CyAu9Gll.js";import{E as I}from"./el-switch.DZq8KFyg.js";import"./el-form-item.l0sNRNKZ.js";import{d as A}from"./index.B6fdKp2E.js";import{_ as q}from"./oauth.vue_vue_type_script_setup_true_lang.DsuBB0NM.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as Q}from"./index.CWr3KaP0.js";import"./strings.DM4HtHVe.js";import"./index.H2r2dG6H.js";import"./_Uint8Array.4jrYBpH3.js";import"./isUndefined.DgmxjSXK.js";import"./use-dialog.DWl0CYH9.js";import"./refs.BfWbpsBM.js";import"./el-tab-pane.DKPBtN8p.js";const G={id:"",password:"",realname:"",email:"",work_wechat_uid:"",role_ids:[],username:"",role_name:""},N={class:"app-container"},Y={class:"search-container"},J={class:"pagination-container"},K={style:{"text-align":"right"}};const W=H({setup(){const a=e(),{device:t}=l(a);return{device:t}},data:()=>({input:{page:1,limit:10,user_name:"",real_name:"",is_ban:!1},count:0,updatePwdForm:{password:"",confirmPassword:"",id:0},pwdDialogVisible:!1,role:Object.assign({},G),routes:[],loading:!1,rolesList:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},chanCfgList:[],chanCfgMap:[]}),computed:{isMobile(){return this.device===a.MOBILE}},async created(){await this.getRoleOpt(),this.getUserList(1)},components:{Oauth:q},methods:{async getRoleOpt(){const e=await t();for(var l of e.data)this.chanCfgList.push(l),this.chanCfgMap[l.id]=l.name},handleSizeChange(e){this.input.limit=e,this.getUserList(1)},async getUserList(e){this.input.page=e||1,this.loading=!0;const l=await s({page:e,page_size:this.input.limit,user_name:this.input.user_name,real_name:this.input.real_name,is_ban:this.input.is_ban});this.loading=!1,this.count=l.data.count,this.rolesList=l.data.list},async submitPwdForm(){if(""==this.updatePwdForm.password)return void o.error({message:"密码不能为空",type:"error"});if(this.updatePwdForm.confirmPassword!=this.updatePwdForm.password)return void o.error({message:"两次密码输入不一致",type:"error"});const e=await i(this.updatePwdForm);0==e.code?(o.success({message:e.msg,type:"success"}),this.updatePwdForm.password="",this.updatePwdForm.confirmPassword="",this.pwdDialogVisible=!1):o.error({message:e.msg,type:"error"})},openPwdDialog(e){this.updatePwdForm.id=e.id,this.pwdDialogVisible=!0},handleAddRole(){this.role=Object.assign({},G),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.role=A(e.row),this.role.password=""},handleDelete({$index:e,row:l}){r.confirm("确认删除该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await d({id:l.id});0==e.code?(this.getUserList(1),o.success({type:"success",offset:60,message:e.msg})):o({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},SealUser({$index:e,row:l}){r.confirm("确认封禁该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await n({id:l.id});0==e.code?(this.getUserList(1),o.success({type:"success",offset:60,message:e.msg})):o({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},UnSealUser({$index:e,row:l}){r.confirm("确认解封该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await u({id:l.id});0==e.code?(this.getUserList(1),o.success({type:"success",offset:60,message:e.msg})):o({type:"error",offset:60,message:e.msg})})).catch((e=>{console.error(e)}))},async confirmRole(){const e="edit"===this.dialogType;if(0==this.role.role_ids.length)return o.error({message:"角色不能为空",type:"error"}),!1;if(e){const e=await c(this.role);if(0!=e.code)return void o.error({message:e.msg,type:"error"});o.success({message:e.msg,type:"success"}),this.getUserList(1)}else{if(this.role.password.length<5&&""!=this.role.password.trim())return o.error({message:"密码长度必须大于5",type:"error"}),!1;const e=await p(this.role);if(0!=e.code)return void o.error({message:e.msg,type:"error"});o.success({message:e.msg,type:"success"}),this.getUserList(1)}this.dialogVisible=!1}}},[["render",function(e,l,a,t,s,o){const i=j,r=O,d=I,n=x,u=R,c=S,p=Q,A=z,q=M,H=B,G=T,W=E,X=F,Z=D,ee=v,le=L,ae=P;return m(),g("div",N,[h("div",Y,[f(u,{inline:!0},{default:w((()=>[f(r,{label:"用户名:"},{default:w((()=>[f(i,{clearable:"",modelValue:s.input.user_name,"onUpdate:modelValue":l[0]||(l[0]=e=>s.input.user_name=e),style:{width:"200px"}},null,8,["modelValue"])])),_:1}),f(r,{label:"姓名:"},{default:w((()=>[f(i,{clearable:"",modelValue:s.input.real_name,"onUpdate:modelValue":l[1]||(l[1]=e=>s.input.real_name=e),style:{width:"200px"}},null,8,["modelValue"])])),_:1}),f(r,{label:"是否封禁:"},{default:w((()=>[f(d,{onChange:l[2]||(l[2]=e=>o.getUserList(1)),modelValue:s.input.is_ban,"onUpdate:modelValue":l[3]||(l[3]=e=>s.input.is_ban=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1}),f(r,{label:""},{default:w((()=>[f(n,{type:"success",class:"filter-item",onClick:l[4]||(l[4]=e=>o.getUserList(1))},{default:w((()=>[_(b(e.$t("查询")),1)])),_:1}),f(n,{type:"warning",class:"filter-item",onClick:o.handleAddRole},{default:w((()=>[_(b(e.$t("新增")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})]),f(W,{shadow:"never",class:"table-container"},{default:w((()=>[y((m(),V(G,{data:s.rolesList},{default:w((()=>[f(c,{align:"center",sortable:"",label:"id",width:"50"},{default:w((e=>[_(b(e.row.id),1)])),_:1}),f(c,{align:"center",label:e.$t("用户名"),width:"100"},{default:w((e=>[_(b(e.row.username),1)])),_:1},8,["label"]),f(c,{align:"center",label:e.$t("所属角色")},{default:w((e=>[(m(!0),g(k,null,C(e.row.role_ids,(e=>(m(),V(p,null,{default:w((()=>[_(b(s.chanCfgMap[e]),1)])),_:2},1024)))),256))])),_:1},8,["label"]),f(c,{align:"center",width:"100",label:e.$t("姓名")},{default:w((e=>[_(b(e.row.realname),1)])),_:1},8,["label"]),f(c,{align:"center",width:"200",label:e.$t("电子邮箱")},{default:w((e=>[_(b(e.row.email),1)])),_:1},8,["label"]),f(c,{align:"center",width:"100",label:e.$t("企微成员UserID")},{default:w((e=>[_(b(e.row.work_wechat_uid),1)])),_:1},8,["label"]),f(c,{align:"center",sortable:"",width:"180",label:e.$t("创建时间")},{default:w((e=>[_(b(e.row.create_time),1)])),_:1},8,["label"]),f(c,{align:"center",sortable:"",width:"180",label:e.$t("修改时间")},{default:w((e=>[_(b(e.row.update_time),1)])),_:1},8,["label"]),f(c,{align:"center",sortable:"",width:"180",label:e.$t("最后登录时间")},{default:w((e=>[_(b(e.row.last_login_time),1)])),_:1},8,["label"]),f(c,{align:"center",label:e.$t("操作"),fixed:"right",width:o.isMobile?80:400},{default:w((l=>[o.isMobile?(m(),V(H,{key:1,trigger:"click"},{dropdown:w((()=>[f(q,null,{default:w((()=>[f(A,{command:"1"},{default:w((()=>[f(n,{type:"primary",onClick:U((e=>o.handleEdit(l)),["stop"])},{default:w((()=>[_(b(e.$t("编辑")),1)])),_:2},1032,["onClick"])])),_:2},1024),f(A,null,{default:w((()=>[f(n,{type:"info",onClick:e=>o.openPwdDialog(l.row)},{default:w((()=>[_(b(e.$t("重置密码")),1)])),_:2},1032,["onClick"])])),_:2},1024),f(A,null,{default:w((()=>[1==l.row.is_ban?(m(),V(n,{key:0,type:"primary",onClick:e=>o.UnSealUser(l)},{default:w((()=>[_(b(e.$t("解封")),1)])),_:2},1032,["onClick"])):$("",!0),0==l.row.is_ban?(m(),V(n,{key:1,type:"danger",onClick:e=>o.SealUser(l)},{default:w((()=>[_(b(e.$t("封禁")),1)])),_:2},1032,["onClick"])):$("",!0)])),_:2},1024),f(A,null,{default:w((()=>[f(n,{type:"danger",onClick:e=>o.handleDelete(l)},{default:w((()=>[_(b(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:w((()=>[f(n,null,{default:w((()=>[_("管理")])),_:1})])),_:2},1024)):(m(),g(k,{key:0},[f(n,{type:"primary",onClick:e=>o.handleEdit(l)},{default:w((()=>[_(b(e.$t("编辑")),1)])),_:2},1032,["onClick"]),f(n,{type:"info",onClick:e=>o.openPwdDialog(l.row)},{default:w((()=>[_(b(e.$t("重置密码")),1)])),_:2},1032,["onClick"]),1==l.row.is_ban?(m(),V(n,{key:0,type:"primary",onClick:e=>o.UnSealUser(l)},{default:w((()=>[_(b(e.$t("解封")),1)])),_:2},1032,["onClick"])):$("",!0),0==l.row.is_ban?(m(),V(n,{key:1,type:"danger",onClick:e=>o.SealUser(l)},{default:w((()=>[_(b(e.$t("封禁")),1)])),_:2},1032,["onClick"])):$("",!0),f(n,{type:"danger",onClick:e=>o.handleDelete(l)},{default:w((()=>[_(b(e.$t("删除")),1)])),_:2},1032,["onClick"])],64))])),_:1},8,["label","width"])])),_:1},8,["data"])),[[ae,s.loading]])])),_:1}),h("div",J,[f(X,{background:"","current-page":s.input.page,"page-size":s.input.limit,total:s.count,onCurrentChange:o.getUserList,onSizeChange:o.handleSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])]),f(Z,{title:"修改密码",modelValue:s.pwdDialogVisible,"onUpdate:modelValue":l[8]||(l[8]=e=>s.pwdDialogVisible=e),size:o.isMobile?"100%":"30%"},{footer:w((()=>[f(n,{onClick:l[7]||(l[7]=e=>s.pwdDialogVisible=!1)},{default:w((()=>[_("取消")])),_:1}),f(n,{type:"primary",onClick:o.submitPwdForm},{default:w((()=>[_("修改")])),_:1},8,["onClick"])])),default:w((()=>[f(u,{"label-width":"100px"},{default:w((()=>[f(r,{label:"新密码",required:""},{default:w((()=>[f(i,{modelValue:s.updatePwdForm.password,"onUpdate:modelValue":l[5]||(l[5]=e=>s.updatePwdForm.password=e),"show-password":"",type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])])),_:1}),f(r,{label:"确认密码",required:""},{default:w((()=>[f(i,{modelValue:s.updatePwdForm.confirmPassword,"onUpdate:modelValue":l[6]||(l[6]=e=>s.updatePwdForm.confirmPassword=e),"show-password":"",type:"password",placeholder:"请再次输入新密码"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","size"]),f(Z,{modelValue:s.dialogVisible,"onUpdate:modelValue":l[16]||(l[16]=e=>s.dialogVisible=e),size:o.isMobile?"100%":"50%",title:"edit"===s.dialogType?e.$t("编辑用户信息"):e.$t("新建用户信息")},{default:w((()=>[f(u,{model:s.role,"label-width":"100px","label-position":"left"},{default:w((()=>[f(r,{label:e.$t("用户名")},{default:w((()=>[f(i,{modelValue:s.role.username,"onUpdate:modelValue":l[9]||(l[9]=e=>s.role.username=e),placeholder:e.$t("用户名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),"edit"!==s.dialogType?(m(),V(r,{key:0,label:e.$t("密码")},{default:w((()=>[f(i,{"show-password":"",type:"password",modelValue:s.role.password,"onUpdate:modelValue":l[10]||(l[10]=e=>s.role.password=e),placeholder:e.$t("不填则为系统自动生成")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):$("",!0),f(r,{label:e.$t("姓名")},{default:w((()=>[f(i,{modelValue:s.role.realname,"onUpdate:modelValue":l[11]||(l[11]=e=>s.role.realname=e),placeholder:e.$t("姓名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),f(r,{label:e.$t("电子邮箱")},{default:w((()=>[f(i,{modelValue:s.role.email,"onUpdate:modelValue":l[12]||(l[12]=e=>s.role.email=e),placeholder:e.$t("电子邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),f(r,{label:e.$t("企微UserID")},{default:w((()=>[f(i,{modelValue:s.role.work_wechat_uid,"onUpdate:modelValue":l[13]||(l[13]=e=>s.role.work_wechat_uid=e),placeholder:e.$t("企业微信成员UserID。对应管理端的账号，企业内必须唯一")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),f(r,{label:e.$t("请选择角色")},{default:w((()=>[f(le,{modelValue:s.role.role_ids,"onUpdate:modelValue":l[14]||(l[14]=e=>s.role.role_ids=e),multiple:"",placeholder:e.$t("请选择角色"),clearable:"",filterable:""},{default:w((()=>[(m(!0),g(k,null,C(s.chanCfgList,(e=>(m(),V(ee,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model"]),h("div",K,[f(n,{type:"danger",onClick:l[15]||(l[15]=e=>s.dialogVisible=!1)},{default:w((()=>[_(b(e.$t("取消")),1)])),_:1}),f(n,{type:"primary",onClick:o.confirmRole},{default:w((()=>[_(b(e.$t("确认")),1)])),_:1},8,["onClick"])])])),_:1},8,["modelValue","size","title"])])}],["__scopeId","data-v-02f608ec"]]);export{W as default};
