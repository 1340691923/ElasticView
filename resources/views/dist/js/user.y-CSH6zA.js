import{br as e,c7 as l,aY as a,dP as t,aP as s,dQ as o,dR as r,dS as i,dT as d,dU as n,au as c,e as p,h as u,C as m,l as h,w as g,a7 as f,F as w,S as b,V as _,f as y,p as V,a6 as k,a5 as $}from"./index.DMBpWXpT.js";/* empty css               */import{E as U,a as C}from"./el-select.C9ddzdnq.js";import"./el-scrollbar.BJ_tYB1D.js";import"./el-popper.Cb3Eus9m.js";import{E as j}from"./el-drawer.CpqknkfB.js";import{E as P}from"./el-card.BhvZLWwX.js";import{E as x,a as D}from"./el-table-column.Dl1jn1Bd.js";import"./el-checkbox.8MJHthul.js";import"./el-tooltip.l0sNRNKZ.js";import{a as F,E as v}from"./el-form.DUR-mZNt.js";import"./el-form-item.l0sNRNKZ.js";import{d as L}from"./index.B6fdKp2E.js";import{_ as T}from"./oauth.vue_vue_type_script_setup_true_lang.DbnOqKxM.js";import{_ as E}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as S}from"./index.qeCV5ckY.js";import"./token.DWNpOE8r.js";import"./strings.DeQ3Zoz4.js";import"./isEqual.B61-3bNT.js";import"./_Uint8Array.BEOPqGcx.js";import"./debounce.l44evi-0.js";import"./index.CP01f_MK.js";import"./castArray.arHVDzqw.js";import"./isUndefined.DgmxjSXK.js";import"./use-dialog.CoOh9qjD.js";import"./el-tab-pane.Dc62g1GH.js";import"./el-switch.BvIaL9AI.js";const A={id:"",password:"",realname:"",email:"",work_wechat_uid:"",role_ids:[],username:"",role_name:""},R={class:"app-container"},B={class:"search-container"},O={style:{"text-align":"right"}};const I=E({data:()=>({updatePwdForm:{password:"",confirmPassword:"",id:0},authDialogVisible:!1,pwdDialogVisible:!1,role:Object.assign({},A),routes:[],rolesList:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},chanCfgList:[],chanCfgMap:[]}),computed:{},async created(){await this.getRoleOpt(),this.getUserList()},components:{Oauth:T},methods:{async getRoleOpt(){const l=await e();for(var a of l.data)this.chanCfgList.push(a),this.chanCfgMap[a.id]=a.name},async getUserList(){const e=await l();this.rolesList=e.data},async submitPwdForm(){if(""==this.updatePwdForm.password)return void a.error({message:"密码不能为空",type:"error"});if(this.updatePwdForm.confirmPassword!=this.updatePwdForm.password)return void a.error({message:"两次密码输入不一致",type:"error"});const e=await t(this.updatePwdForm);0==e.code?(a.success({message:e.msg,type:"success"}),this.updatePwdForm.password="",this.updatePwdForm.confirmPassword="",this.pwdDialogVisible=!1):a.error({message:e.msg,type:"error"})},openAuthCfgDialog(){this.authDialogVisible=!0},openPwdDialog(e){this.updatePwdForm.id=e.id,this.pwdDialogVisible=!0},handleAddRole(){this.role=Object.assign({},A),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.role=L(e.row),this.role.password=""},handleDelete({$index:e,row:l}){s.confirm("确认删除该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o({id:l.id});0==e.code?(this.getUserList(),a.success({type:"success",message:e.msg})):a({type:"error",message:e.msg})})).catch((e=>{console.error(e)}))},SealUser({$index:e,row:l}){s.confirm("确认封禁该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await r({id:l.id});0==e.code?(this.getUserList(),a.success({type:"success",message:e.msg})):a({type:"error",message:e.msg})})).catch((e=>{console.error(e)}))},UnSealUser({$index:e,row:l}){s.confirm("确认解封该用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await i({id:l.id});0==e.code?(this.getUserList(),a.success({type:"success",message:e.msg})):a({type:"error",message:e.msg})})).catch((e=>{console.error(e)}))},async confirmRole(){const e="edit"===this.dialogType;if(0==this.role.role_ids.length)return a.error({message:"角色不能为空",type:"error"}),!1;if(e){const e=await d(this.role);if(0!=e.code)return void a.error({message:e.msg,type:"error"});a.success({message:e.msg,type:"success"}),this.getUserList()}else{if(this.role.password.length<5&&""!=this.role.password.trim())return a.error({message:"密码长度必须大于5",type:"error"}),!1;const e=await n(this.role);if(0!=e.code)return void a.error({message:e.msg,type:"error"});a.success({message:e.msg,type:"success"}),this.getUserList()}this.dialogVisible=!1}}},[["render",function(e,l,a,t,s,o){const r=k,i=F,d=v,n=x,L=S,T=D,E=P,A=c("oauth"),I=j,M=$,q=U,z=C;return p(),u("div",R,[m("div",B,[h(d,{inline:!0},{default:g((()=>[h(i,{label:""},{default:g((()=>[h(r,{type:"info",class:"filter-item",onClick:o.openAuthCfgDialog},{default:g((()=>[f(w(e.$t("第三方认证设置")),1)])),_:1},8,["onClick"])])),_:1}),h(i,{label:""},{default:g((()=>[h(r,{type:"warning",class:"filter-item",onClick:o.handleAddRole},{default:g((()=>[f(w(e.$t("新建用户")),1)])),_:1},8,["onClick"])])),_:1}),h(i,{label:""},{default:g((()=>[h(r,{type:"success",class:"filter-item",onClick:o.getUserList},{default:g((()=>[f(w(e.$t("查询")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})]),h(E,{shadow:"never",class:"table-container"},{default:g((()=>[h(T,{data:s.rolesList},{default:g((()=>[h(n,{align:"center",label:"id",width:"50"},{default:g((e=>[f(w(e.row.id),1)])),_:1}),h(n,{align:"center",label:e.$t("用户名"),width:"220"},{default:g((e=>[f(w(e.row.username),1)])),_:1},8,["label"]),h(n,{align:"center",label:e.$t("所属角色"),width:"220"},{default:g((e=>[(p(!0),u(b,null,_(e.row.role_ids,(e=>(p(),y(L,null,{default:g((()=>[f(w(s.chanCfgMap[e]),1)])),_:2},1024)))),256))])),_:1},8,["label"]),h(n,{align:"center",label:e.$t("真实姓名")},{default:g((e=>[f(w(e.row.realname),1)])),_:1},8,["label"]),h(n,{align:"center",label:e.$t("电子邮箱")},{default:g((e=>[f(w(e.row.email),1)])),_:1},8,["label"]),h(n,{align:"center",label:e.$t("企业微信成员UserID")},{default:g((e=>[f(w(e.row.work_wechat_uid),1)])),_:1},8,["label"]),h(n,{align:"center",label:e.$t("操作"),fixed:"right",width:"340"},{default:g((l=>[h(r,{type:"primary",onClick:e=>o.handleEdit(l)},{default:g((()=>[f(w(e.$t("编辑")),1)])),_:2},1032,["onClick"]),h(r,{type:"info",onClick:e=>o.openPwdDialog(l.row)},{default:g((()=>[f(w(e.$t("重置密码")),1)])),_:2},1032,["onClick"]),1==l.row.is_ban?(p(),y(r,{key:0,type:"primary",onClick:e=>o.UnSealUser(l)},{default:g((()=>[f(w(e.$t("解封")),1)])),_:2},1032,["onClick"])):V("",!0),0==l.row.is_ban?(p(),y(r,{key:1,type:"danger",onClick:e=>o.SealUser(l)},{default:g((()=>[f(w(e.$t("封禁")),1)])),_:2},1032,["onClick"])):V("",!0),h(r,{type:"danger",onClick:e=>o.handleDelete(l)},{default:g((()=>[f(w(e.$t("删除")),1)])),_:2},1032,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"])])),_:1}),h(I,{title:"第三方认证设置",modelValue:s.authDialogVisible,"onUpdate:modelValue":l[0]||(l[0]=e=>s.authDialogVisible=e),size:"90%"},{default:g((()=>[s.authDialogVisible?(p(),y(A,{key:0})):V("",!0)])),_:1},8,["modelValue"]),h(I,{title:"修改密码",modelValue:s.pwdDialogVisible,"onUpdate:modelValue":l[4]||(l[4]=e=>s.pwdDialogVisible=e),size:"30%"},{footer:g((()=>[h(r,{onClick:l[3]||(l[3]=e=>s.pwdDialogVisible=!1)},{default:g((()=>[f("取消")])),_:1}),h(r,{type:"primary",onClick:o.submitPwdForm},{default:g((()=>[f("修改")])),_:1},8,["onClick"])])),default:g((()=>[h(d,{"label-width":"100px"},{default:g((()=>[h(i,{label:"新密码",required:""},{default:g((()=>[h(M,{modelValue:s.updatePwdForm.password,"onUpdate:modelValue":l[1]||(l[1]=e=>s.updatePwdForm.password=e),"show-password":"",type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])])),_:1}),h(i,{label:"确认密码",required:""},{default:g((()=>[h(M,{modelValue:s.updatePwdForm.confirmPassword,"onUpdate:modelValue":l[2]||(l[2]=e=>s.updatePwdForm.confirmPassword=e),"show-password":"",type:"password",placeholder:"请再次输入新密码"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),h(I,{modelValue:s.dialogVisible,"onUpdate:modelValue":l[12]||(l[12]=e=>s.dialogVisible=e),size:"85%",title:"edit"===s.dialogType?e.$t("编辑用户信息"):e.$t("新建用户信息")},{default:g((()=>[h(d,{model:s.role,"label-width":"200px","label-position":"left"},{default:g((()=>[h(i,{label:e.$t("用户名")},{default:g((()=>[h(M,{modelValue:s.role.username,"onUpdate:modelValue":l[5]||(l[5]=e=>s.role.username=e),placeholder:e.$t("用户名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),"edit"!==s.dialogType?(p(),y(i,{key:0,label:e.$t("密码")},{default:g((()=>[h(M,{"show-password":"",type:"password",modelValue:s.role.password,"onUpdate:modelValue":l[6]||(l[6]=e=>s.role.password=e),placeholder:e.$t("不填则为系统自动生成")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):V("",!0),h(i,{label:e.$t("真实姓名")},{default:g((()=>[h(M,{modelValue:s.role.realname,"onUpdate:modelValue":l[7]||(l[7]=e=>s.role.realname=e),placeholder:e.$t("真实姓名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),h(i,{label:e.$t("电子邮箱")},{default:g((()=>[h(M,{modelValue:s.role.email,"onUpdate:modelValue":l[8]||(l[8]=e=>s.role.email=e),placeholder:e.$t("电子邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),h(i,{label:e.$t("企业微信成员UserID")},{default:g((()=>[h(M,{modelValue:s.role.work_wechat_uid,"onUpdate:modelValue":l[9]||(l[9]=e=>s.role.work_wechat_uid=e),placeholder:e.$t("企业微信成员UserID。对应管理端的账号，企业内必须唯一")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),h(i,{label:e.$t("请选择角色")},{default:g((()=>[h(z,{modelValue:s.role.role_ids,"onUpdate:modelValue":l[10]||(l[10]=e=>s.role.role_ids=e),multiple:"",placeholder:e.$t("请选择角色"),clearable:"",filterable:""},{default:g((()=>[(p(!0),u(b,null,_(s.chanCfgList,(e=>(p(),y(q,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model"]),m("div",O,[h(r,{type:"danger",onClick:l[11]||(l[11]=e=>s.dialogVisible=!1)},{default:g((()=>[f(w(e.$t("取消")),1)])),_:1}),h(r,{type:"primary",onClick:o.confirmRole},{default:g((()=>[f(w(e.$t("确认")),1)])),_:1},8,["onClick"])])])),_:1},8,["modelValue","title"])])}],["__scopeId","data-v-951986b8"]]);export{I as default};
